import React, { useState, useMemo } from 'react';
import { User, DollarSign, Coins, Star, Lock, Unlock, ShoppingCart, TrendingUp, Search, ChevronDown, ChevronUp, Target, Award, Package, Skull, Box, Compass, Wine, Leaf, MapPin, Crosshair, Shirt, Tent, ScrollText, Sparkles, Zap, Train } from 'lucide-react';
import './index.css';

// =========================================================================
// MODULAR DATA IMPORTS - Game economy data separated from UI
// =========================================================================
import {
  FAST_TRAVEL_LOCATIONS,
  FAST_TRAVEL_PROMO,
  getCurrentFastTravelCost,
} from './data/fastTravel';

import {
  CATALOG,
} from './data/catalog-items';

import {
  XP_BONUSES,
  COLLECTOR_SETS,
  COLLECTOR_TOTAL_VALUE,
  ROLE_PAYOUTS,
  RDO_UPDATE_INFO,
} from './data/bonuses';

import {
  RANK_XP_TABLE,
  ROLE_XP_TABLE,
  PROGRESSION_WEIGHTS,
  HUNTING_VALUES,
} from './data/progression';

// =========================================================================
// UI CONFIG IMPORTS - Icons and styling separated from data
// =========================================================================
import { ROLE_UI, TYPE_UI, PRIORITY_UI } from './ui/icons';

// Alias for backward compatibility with existing component code
const PRIORITY_CONFIG = PRIORITY_UI;
const TYPE_CONFIG = TYPE_UI;

// =========================================================================
// ROLES - UI config with icons (merges data + presentation)
// =========================================================================
const ROLES = {
  collector: { name: 'Collector', color: 'text-violet-400', bg: 'bg-violet-500', icon: Compass, maxLevel: 20, unlockCost: 15, desc: 'Best passive income' },
  trader: { name: 'Trader', color: 'text-amber-500', bg: 'bg-amber-500', icon: Box, maxLevel: 20, unlockCost: 15, desc: 'Camp supply runs' },
  bountyHunter: { name: 'Bounty Hunter', color: 'text-red-400', bg: 'bg-red-500', icon: Skull, maxLevel: 30, unlockCost: 15, desc: 'Earns Gold Bars' },
  moonshiner: { name: 'Moonshiner', color: 'text-cyan-400', bg: 'bg-cyan-500', icon: Wine, maxLevel: 20, unlockCost: 25, desc: 'Requires Trader 5' },
  naturalist: { name: 'Naturalist', color: 'text-emerald-400', bg: 'bg-emerald-500', icon: Leaf, maxLevel: 20, unlockCost: 25, desc: 'Sampling & sedation' },
};

// =========================================================================
// XP HELPER FUNCTIONS
// =========================================================================

// Helper: Calculate level from XP
const getLevelFromXP = (xp, isRole = false, maxLevel = 100) => {
  const table = isRole ? ROLE_XP_TABLE : RANK_XP_TABLE;
  let level = 1;
  for (let i = 1; i < Math.min(table.length, maxLevel + 1); i++) {
    if (xp >= table[i]) level = i;
    else break;
  }
  return Math.min(level, maxLevel);
};

// Helper: Get XP progress within current level
const getXPProgress = (xp, isRole = false, maxLevel = 100) => {
  const table = isRole ? ROLE_XP_TABLE : RANK_XP_TABLE;
  const level = getLevelFromXP(xp, isRole, maxLevel);
  if (level >= maxLevel || level >= table.length - 1) return { current: 0, needed: 0, percent: 100 };
  
  const currentLevelXP = table[level];
  const nextLevelXP = table[level + 1];
  const xpIntoLevel = xp - currentLevelXP;
  const xpNeeded = nextLevelXP - currentLevelXP;
  
  return {
    current: xpIntoLevel,
    needed: xpNeeded,
    percent: Math.min(100, (xpIntoLevel / xpNeeded) * 100)
  };
};

// =========================================================================
// PLAYER PROFILE COMPONENT (MAIN FEATURE) - WITH XP TRACKING
// =========================================================================

// Progress Bar Component - ENHANCED WITH ANIMATION
function ProgressBar({ percent, color, height = 'h-2', animated = true }) {
  return (
    <div className={`w-full ${height} bg-white/10 rounded-full overflow-hidden backdrop-blur-sm`}>
      <div 
        className={`${height} ${color} rounded-full transition-all duration-500 ease-out ${animated ? 'animate-pulse' : ''}`}
        style={{ width: `${Math.min(100, percent)}%` }}
      />
    </div>
  );
}
    specialAmmo: { xp: 5, desc: 'Kill with non-standard ammo' },
    distance: { xp: 5, desc: 'Kill outside lock-on range' },
    deathRider: { xp: 5, desc: 'Kill while on horseback' },
    revenge: { xp: 5, desc: 'Kill player who killed you' },
    assist: { xp: 5, desc: 'Damage before ally finishes' },
  },
  hunting: {
    mediumLargeKill: { xp: 10, desc: 'Kill medium/large game' },
    mediumLargeSkin: { xp: 10, desc: 'Skin medium/large game' },
    smallKill: { xp: 5, desc: 'Kill small game/birds' },
    smallSkin: { xp: 5, desc: 'Skin small game/birds' },
  },
  misc: {
    revive: { xp: 5, desc: 'Revive a downed Player' },
    hatShot: { xp: 5, desc: 'Shoot off enemy hat' },
    disarm: { xp: 5, desc: 'Shoot weapon from NPC hand' },
    lastChance: { xp: 5, desc: 'Kill with last bullet before reload' },
  },
};

// =========================================================================
// COLLECTOR SET VALUES - VERIFIED FROM JEAN ROPKE MAP + REDDIT FAQ
// Source: jeanropke.github.io/RDR2CollectorsMap, r/RedDeadOnline
// =========================================================================

const COLLECTOR_SETS = {
  coins: { name: 'Coins', items: 15, value: 540, perItem: 36.00, difficulty: 'hard', requiresDetector: true },
  necklaces: { name: 'Necklaces', items: 9, value: 335, perItem: 37.22, difficulty: 'medium', requiresDetector: true },
  rings: { name: 'Rings', items: 11, value: 378, perItem: 34.36, difficulty: 'medium', requiresDetector: true },
  bracelets: { name: 'Bracelets', items: 8, value: 271.50, perItem: 33.94, difficulty: 'medium', requiresDetector: true },
  earrings: { name: 'Earrings', items: 11, value: 364.50, perItem: 33.14, difficulty: 'medium', requiresDetector: true },
  megafaunaFossils: { name: 'Megafauna Fossils', items: 6, value: 321, perItem: 53.50, difficulty: 'hard', requiresDetector: true, note: 'BEST $/item' },
  oceanicFossils: { name: 'Oceanic Fossils', items: 7, value: 288.50, perItem: 41.21, difficulty: 'hard', requiresDetector: true },
  coastalFossils: { name: 'Coastal Fossils', items: 7, value: 217, perItem: 31.00, difficulty: 'hard', requiresDetector: true },
  arrowheads: { name: 'Arrowheads', items: 12, value: 289, perItem: 24.08, difficulty: 'medium', requiresDetector: true },
  heirlooms: { name: 'Family Heirlooms', items: 15, value: 292.50, perItem: 19.50, difficulty: 'medium', requiresDetector: false },
  tarotCups: { name: 'Tarot - Cups', items: 14, value: 240.50, perItem: 17.18, difficulty: 'easy', requiresDetector: false },
  tarotSwords: { name: 'Tarot - Swords', items: 14, value: 286.50, perItem: 20.46, difficulty: 'easy', requiresDetector: false },
  tarotWands: { name: 'Tarot - Wands', items: 14, value: 239, perItem: 17.07, difficulty: 'easy', requiresDetector: false },
  tarotPentacles: { name: 'Tarot - Pentacles', items: 14, value: 287, perItem: 20.50, difficulty: 'easy', requiresDetector: false },
  wildFlowers: { name: 'American Wild Flowers', items: 9, value: 155.50, perItem: 17.28, difficulty: 'easy', requiresDetector: false },
  eggs: { name: 'Bird Eggs', items: 9, value: 182.50, perItem: 20.28, difficulty: 'medium', requiresDetector: false },
  bottles: { name: 'Antique Alcohol Bottles', items: 9, value: 160.50, perItem: 17.83, difficulty: 'easy', requiresDetector: false },
};

// Total value of all collections
const COLLECTOR_TOTAL_VALUE = Object.values(COLLECTOR_SETS).reduce((sum, set) => sum + set.value, 0);
// ~$4,700+ for all collections

// =========================================================================
// ROLE PAYOUT DATA - VERIFIED FROM RDO SUBREDDIT FAQ
// Source: reddit.com/r/RedDeadOnline/comments/casp8b/
// =========================================================================

const ROLE_PAYOUTS = {
  trader: {
    localDelivery: { owner: 500, posse: 250, goods: 100, risk: 'Low' },
    distantDelivery: { owner: 625, posse: 312.50, goods: 100, risk: 'High (PvP)' },
    resupply: { owner: 0, posse: 0, materials: 20, note: 'Time-based, wait does NOT increase payout' },
  },
  moonshiner: {
    weakMoonshine: { owner: 50, cost: 30, profit: 20, time: '30m' },
    averageMoonshine: { owner: 100, cost: 60, profit: 40, time: '45m' },
    strongMoonshine: { owner: 226, cost: 50, profit: 176, time: '48m', note: 'Best profit after upgrades' },
  },
  bountyHunter: {
    // Payout increases with time spent (up to 12 minutes optimal)
    '$': { gold: 0.08, cash: 10, xp: 200, timeMin: 0, timeMax: 3 },
    '$$': { gold: 0.16, cash: 20, xp: 400, timeMin: 6, timeMax: 9 },
    '$$$': { gold: 0.24, cash: 40, xp: 600, timeMin: 9, timeMax: 12, note: 'Wait until last 30s for max payout' },
    legendaryBounty: { gold: 0.48, cash: 100, xp: 1500, note: '5-star difficulty, ~20 min' },
  },
};

// =========================================================================
// RDO UPDATE SCHEDULE & CURRENT BONUSES
// Source: r/RedDeadOnline community tracking (reddit.com/r/RedDeadOnline)
// Verification: Monthly bonus posts by u/PapaXan, community megathreads
// =========================================================================

const RDO_UPDATE_INFO = {
  // === UPDATE SCHEDULE (Verified July 2022 - Present) ===
  schedule: {
    type: 'monthly',
    timing: 'First Tuesday of each month, 5am EST',
    source: 'Rockstar July 2022 Community Update',
    sourceUrl: 'https://www.rockstargames.com/newswire/article/9k74k52737912k/grand-theft-auto-and-red-dead-online-community-update',
    verifiedVia: 'reddit.com/r/RedDeadOnline/comments/vtnbww (July 2022 Megathread)',
    notes: [
      'Weekly updates discontinued July 2022',
      'Monthly events rotate role bonuses (Bounty Hunter → Collector → Trader → Moonshiner → Naturalist)',
      'Base catalog prices are static; discounts only during monthly events',
      'Holiday events (Halloween, Christmas) still occur annually',
    ],
  },

  // === DECEMBER 2025 EVENT (Dec 2 - Jan 6) ===
  // Source: reddit.com/r/RedDeadOnline/comments/1pboa58/monthly_discounts_and_bonuses_december_2nd_to/
  currentEvent: {
    name: 'Holiday 2025 / Naturalist Month',
    dateRange: 'December 2, 2025 - January 6, 2026',
    lastUpdated: '2025-12-04',
    verified: true,
    
    bonuses: {
      naturalistSampleSales: { multiplier: '3X', rewards: 'RDO$, Role XP' },
      freeRoamEvents: { multiplier: '3X', rewards: 'RDO$, Ability Card XP, XP' },
      merryCallToArms: { multiplier: '2X', rewards: 'RDO$, Gold, XP', newMap: 'Fort Wallace' },
      headForTheHills: { multiplier: '2X', rewards: 'RDO$, Gold, XP', newMap: 'Ewing Basin (Dec 2-8)' },
    },
    
    discounts: {
      free: ['Fast Travel', 'Sedative Ammo'],
      goldOff: [{ item: 'Sample Kit', discount: '10 Gold Bars off' }],
      fiftyPercent: ['Novice/Promising Naturalist Items', 'Trinkets', 'Varmint Rifle', 'Pistols', 'Pistol Customization'],
      fortyPercent: ['Cripps Outfits', 'Arabian Horses', 'Mustang Horses', 'Hats', 'Coats', 'Chaps', 'Gloves'],
    },
    
    freeItems: [
      { item: 'Winter Evans Repeater Variant', condition: 'Login Dec 2 - Jan 5' },
      { item: 'Redcliff Outfit (Quick Draw Pass 1)', condition: 'Login Dec 23-31' },
      { item: 'Free Emote + Honor Reset + Weight Loss Tonic', condition: 'Login Jan 1-5' },
      { item: 'Amador Coat (Outlaw Pass 3)', condition: 'Rank 20 Naturalist login' },
      { item: 'Amador Pants (Outlaw Pass 3)', condition: 'Sell any animal sample to Harriet' },
      { item: 'Prowler Hat (Outlaw Pass 1)', condition: 'Sample a Legendary Animal' },
      { item: 'Red Morning Tail Coat', condition: 'Reach Wave 4 in A Merry Call to Arms' },
      { item: 'Krampus Shotgun Variant', condition: 'Returns Dec 9 (rank lock lifted)' },
    ],
  },

  // === JULY 2025 CONTENT UPDATE ===
  // Source: reddit.com/r/RedDeadOnline/comments/1longf3/new_content_for_the_month_of_july_strange_tales/
  recentContent: {
    strangeTalesVol1: {
      name: 'Strange Tales of the West Vol. 1',
      releaseDate: 'July 2025',
      type: 'Telegram Missions',
      verified: true,
      description: 'Theodore Levin needs help investigating bizarre and unexplained mysteries',
      missions: [
        'Strange Tales of the Plague - Undead enemies',
        'Strange Tales of Modern Science - Robot/automaton enemies', 
        'Strange Tales of the Wilderness - Swamp beasts in Bayou Nwa',
        'Additional investigation missions',
      ],
      notes: 'First significant new content since monthly schedule began',
    },
  },

  // === COMMUNITY RESOURCES ===
  resources: {
    weeklyBonuses: 'reddit.com/r/RedDeadOnline (sort by new, look for "Monthly Discounts and Bonuses" posts)',
    dailyChallenges: 'reddit.com/r/RedDeadDailies',
    collectibles: 'jeanropke.github.io/RDR2CollectorsMap',
    madamNazar: 'madamnazar.io',
    communityFAQ: 'reddit.com/r/RedDeadOnline/comments/yoec6k/rreddeadonline_simple_questions_faq_thread/',
  },

  // === HISTORICAL REFERENCE ===
  historicalBonuses: {
    note: 'These were common bonus types during active development',
    roleXP: { typical: '1.5x-3x', affected: 'Rotating monthly role' },
    goldMultiplier: { typical: '2x', affected: 'Featured series, Call to Arms' },
    cashBonus: { typical: '2x-3x', affected: 'Role sales and activities' },
    freeItems: { typical: 'Outlaw Pass items, clothing, weapon variants' },
  },
};

// =========================================================================
// PROGRESSION WEIGHTING SYSTEM - VERIFIED FROM RDO COMMUNITY GUIDES
// Sources: SmurfinGTA Megathread, Captain Balrick's Arsenal, r/RedDeadOnline
// =========================================================================

const PROGRESSION_WEIGHTS = {
  // ===== WEAPON PRIORITY ORDER (Community Consensus) =====
  // Source: SmurfinGTA Weapons Guide
  weapons: {
    essential: [
      { id: 'Bolt Action Rifle', reason: 'Best for hunting AND PvP. One-shot headshots. Everyone needs this.' },
      { id: 'Varmint Rifle', reason: 'Small game hunting. Fast firing for practicing headshots.' },
      { id: 'Lancaster Repeater', reason: 'Best repeater accuracy. Fast hip-fire. All-around meta.' },
      { id: 'Navy Revolver', reason: 'Best sidearm stats. Slow reload but holster trick bypasses it.' },
      { id: 'Pump Shotgun', reason: 'Better range than Semi-Auto. Reliable close combat.' },
    ],
    recommended: [
      { id: 'Carcano Rifle', reason: 'Fast-firing sniper. PvP meta for long range.' },
      { id: 'Semi-Auto Shotgun', reason: 'Fastest hip-fire shotgun. 5 quick shots.' },
      { id: 'LeMat Revolver', reason: '9 rounds + 1 shotgun shell. Great versatility.' },
      { id: 'Improved Bow', reason: 'Stealth hunting. Counters Slippery Bastard with Paint It Black.' },
      { id: 'Sawed-Off Shotgun', reason: 'Sidearm slot shotgun. Dual wield with Navy for versatility.' },
    ],
    optional: [
      { id: 'Rolling Block Rifle', reason: 'One-shot body kills at range. Slower than Carcano.' },
      { id: 'Evans Repeater', reason: '26 rounds. Good for PIB spam builds.' },
      { id: 'Double Action Revolver', reason: 'Fastest dual-wield fire rate. Staggers enemies.' },
      { id: 'Elephant Rifle', reason: 'Legendary animal hunting. Powerful first shot.' },
    ],
  },
  
  // ===== ROLE UNLOCK ORDER (Community Consensus) =====
  // Source: SmurfinGTA Roles Guide, Reddit FAQ
  roleOrder: [
    { 
      role: 'bountyHunter', 
      priority: 1, 
      reason: 'ONLY role that earns Gold Bars. Essential to unlock other roles without real money.',
      goldPerHour: '0.32-0.48',
      tips: ['Wait until last 30 seconds for max payout', '12 minute timer is optimal', 'Legendary bounties give most gold'],
    },
    { 
      role: 'collector', 
      priority: 2, 
      reason: 'Highest cash/hour with Jean Ropke map. Passive income while doing other activities.',
      cashPerHour: '$200-$400',
      tips: ['Use jeanropke.github.io map', 'Metal Detector + Shovel = access to best sets', 'Coins set worth $540'],
    },
    { 
      role: 'trader', 
      priority: 3, 
      reason: 'Good passive income. Hunting fits naturally into gameplay. Unlocks Moonshiner.',
      cashPerHour: '$125-$156',
      tips: ['Distant delivery = 25% more money but PvP risk', 'Hunting Wagon stores 5 large carcasses', 'Legendary pelts from Naturalist work too'],
    },
    { 
      role: 'moonshiner', 
      priority: 4, 
      reason: 'Requires Trader Rank 5. Good semi-passive income. Story missions.',
      cashPerHour: '$88-$220',
      tips: ['Strong moonshine $226 sale, $50 mash cost = $176 profit', 'Upgrade Condenser first, then Polished Copper', 'Bar expansion is cosmetic only'],
    },
    { 
      role: 'naturalist', 
      priority: 5, 
      reason: 'Least profitable. Late game role. Conflicts with Trader (Harriet sprays you for killing).',
      cashPerHour: '$50-$100',
      tips: ['Legendary animals give great Trader materials', 'Wilderness Camp is useful fast travel', 'Sample sets pay poorly vs time investment'],
    },
  ],

  // ===== ABILITY CARD PRIORITY (Community Consensus) =====
  // Source: Captain Balrick's Arsenal, SmurfinGTA Ability Cards Guide
  abilityCards: {
    deadEye: {
      tier1: [
        { id: 'Paint It Black', use: 'PvP/PvE', reason: 'Perfect accuracy. Tag headshots. Counter Slippery Bastard with bow.' },
        { id: 'Slow and Steady', use: 'Tank/PvP', reason: 'Survive headshots. Great with tonics. Stand and deliver.' },
      ],
      tier2: [
        { id: 'Slippery Bastard', use: 'PvP', reason: 'Counter auto-aim. Rush with shotgun or lasso. High skill ceiling.' },
        { id: 'Focus Fire', use: 'Sniper', reason: 'Damage buff for posse. Pairs with Sharpshooter.' },
        { id: 'Quite an Inspiration', use: 'Support', reason: 'Heals entire posse. Great for group content.' },
      ],
    },
    passive: {
      combat: [
        { id: 'Winning Streak', priority: 'essential', reason: 'Damage increases with consecutive hits. Counter tanks.' },
        { id: 'Sharpshooter', priority: 'essential', reason: 'Scope damage buff. Sniper builds.' },
        { id: 'Gunslinger\'s Choice', priority: 'recommended', reason: 'Dual wield accuracy + damage. Sidearm builds.' },
      ],
      recovery: [
        { id: 'Strange Medicine', priority: 'essential', reason: 'Heal on dealing damage. Core PvE card.' },
        { id: 'Cold Blooded', priority: 'essential', reason: 'Heal on kill. Pairs with Strange Medicine.' },
        { id: 'Eye for an Eye', priority: 'recommended', reason: 'Dead Eye restore on headshots. Sustain.' },
      ],
      defense: [
        { id: 'Iron Lung', priority: 'essential', reason: 'More stamina = more health. Universal defense.' },
        { id: 'Fool Me Once', priority: 'essential', reason: 'Take less damage from consecutive shots.' },
        { id: 'Unblinking Eye', priority: 'recommended', reason: 'Longer Dead Eye and Eagle Eye duration.' },
      ],
    },
    builds: {
      pvp: ['Paint It Black', 'Iron Lung', 'Winning Streak', 'Fool Me Once'],
      pve: ['Paint It Black', 'Strange Medicine', 'Cold Blooded', 'Eye for an Eye'],
      tank: ['Slow and Steady', 'Iron Lung', 'Fool Me Once', 'Unblinking Eye'],
      sniper: ['Focus Fire', 'Sharpshooter', 'Iron Lung', 'Unblinking Eye'],
      hunting: ['Paint It Black', 'Unblinking Eye', 'Landon\'s Patience', 'Live for the Fight'],
    },
  },

  // ===== HORSE + SADDLE PRIORITY =====
  horses: {
    earlyGame: { 
      recommendation: 'Any free horse works until Rank 35-40',
      reason: 'Horse stats matter less than saddle/stirrups. Save money for weapons first.',
    },
    metaSetup: {
      saddle: 'Nacogdoches Saddle',
      stirrups: 'Hooded Stirrups',
      reason: 'Best stamina regen (-50% core drain). +35% regen. Available at Rank 35.',
    },
    endgame: [
      { horse: 'Missouri Fox Trotter', reason: 'Best speed + stamina balance. Multi-coat variants.' },
      { horse: 'Arabian', reason: 'Best handling. Skittish around predators. Rose Grey at Rank 68.' },
      { horse: 'Breton', reason: 'Bounty Hunter role. Most brave horse. War class.' },
      { horse: 'Gypsy Cob', reason: 'Trader role. Most health in game. Draft class.' },
    ],
  },

  // ===== PURCHASE PRIORITY BY RANK =====
  purchaseOrder: {
    rank1to10: [
      'Varmint Rifle (Rank 8) - Small game hunting',
      'Bolt Action Rifle (Rank 7) - Large game + PvP',
      'Bow (Rank 10) - Stealth hunting',
    ],
    rank10to25: [
      'Lancaster Repeater (Rank 12) - Best repeater',
      'Off-hand Holster (Rank 25) - Dual wield',
      'Pump Shotgun (Rank 5 but save money early)',
      'First Ability Card upgrades ($350 each)',
    ],
    rank25to50: [
      'Nacogdoches Saddle (Rank 35) - META saddle',
      'Navy Revolver (Rank 0 but save for it)',
      'Carcano Rifle (Rank 50) - Sniper meta',
      'Second role license (15 Gold)',
    ],
    rank50plus: [
      'Upgraded Ability Cards ($500 each)',
      'Role-specific horses (Breton, Gypsy Cob)',
      'Explosive ammo pamphlets (Rank 90+)',
      'Missouri Fox Trotter or Arabian',
    ],
  },
};

// ===== HUNTING EFFICIENCY DATA =====
// Source: SmurfinGTA Hunting Guide, Trader materials values
const HUNTING_VALUES = {
  // Materials value for Cripps (perfect 3-star)
  largeAnimals: {
    whitetailBuck: { materials: 10.00, meat: 2, antlers: true },
    whitetailDeer: { materials: 6.50, meat: 2, antlers: false },
    pronghorn: { materials: 6.50, meat: 2, antlers: true },
    elk: { materials: 12.00, meat: 5, antlers: true },
    moose: { materials: 16.00, meat: 5, antlers: true, rare: true },
    cougar: { materials: 16.50, meat: 1, rare: true },
    panther: { materials: 18.00, meat: 1, rare: true },
    grizzlyBear: { materials: 14.00, meat: 5 },
    blackBear: { materials: 8.00, meat: 4 },
    alligator: { materials: 13.00, meat: 5 },
  },
  mediumAnimals: {
    coyote: { materials: 3.00, meat: 1 },
    fox: { materials: 3.00, meat: 1 },
    beaver: { materials: 3.00, meat: 1 },
    boar: { materials: 6.50, meat: 3 },
    sheep: { materials: 4.00, meat: 2 },
    goat: { materials: 4.00, meat: 2 },
  },
  smallAnimals: {
    rabbit: { materials: 1.00, meat: 1 },
    raccoon: { materials: 1.50, meat: 1 },
    skunk: { materials: 1.00, meat: 1 },
    opossum: { materials: 1.00, meat: 1 },
    muskrat: { materials: 1.50, meat: 1 },
  },
  birds: {
    turkey: { materials: 4.00, meat: 2, feathers: true },
    goose: { materials: 2.00, meat: 1, feathers: true },
    duck: { materials: 1.50, meat: 1, feathers: true },
    heron: { materials: 3.50, plumes: true, note: 'Plumes stack, safe from griefers' },
    spoonbill: { materials: 3.00, plumes: true },
    pelican: { materials: 4.00, feathers: true },
    owl: { materials: 3.50, feathers: true },
    hawk: { materials: 2.00, feathers: true },
    eagle: { materials: 2.50, feathers: true },
  },
  tips: [
    'Plumes stack in satchel - safe from losing on death',
    'Hunting Wagon stores 5 large carcasses + 10 medium/small',
    'Perfect Trader animal = headshot with correct weapon',
    'Bolt Action for large, Varmint for small, Bow for stealth',
    'Fill horse first, then call Hunting Wagon to store more',
  ],
};

// =========================================================================
// XP TABLES - ACCURATE RDO PROGRESSION
// =========================================================================

// Player rank XP requirements (cumulative XP needed for each rank)
const RANK_XP_TABLE = [
  0, 0, 500, 1100, 1800, 2600, 3500, 4500, 5600, 6800, 8100,  // 1-10
  9500, 11000, 12600, 14300, 16100, 18000, 20000, 22100, 24300, 26600,  // 11-20
  29000, 31500, 34100, 36800, 39600, 42500, 45500, 48600, 51800, 55100,  // 21-30
  58500, 62000, 65600, 69300, 73100, 77000, 81000, 85100, 89300, 93600,  // 31-40
  98000, 102500, 107100, 111800, 116600, 121500, 126500, 131600, 136800, 142100,  // 41-50
  147500, 153000, 158600, 164300, 170100, 176000, 182000, 188100, 194300, 200600,  // 51-60
  207000, 213500, 220100, 226800, 233600, 240500, 247500, 254600, 261800, 269100,  // 61-70
  276500, 284000, 291600, 299300, 307100, 315000, 323000, 331100, 339300, 347600,  // 71-80
  356000, 364500, 373100, 381800, 390600, 399500, 408500, 417600, 426800, 436100,  // 81-90
  445500, 455000, 464600, 474300, 484100, 494000, 504000, 514100, 524300, 534600,  // 91-100
];

// Role XP requirements per level (1-20 for roles, 1-30 for Bounty Hunter with prestige)
const ROLE_XP_TABLE = [
  0, 0, 400, 900, 1500, 2200, 3000, 3900, 4900, 5900, 7000,  // 1-10
  8200, 9500, 10900, 12400, 14000, 15700, 17500, 19400, 21400, 23500,  // 11-20
  25700, 28000, 30400, 32900, 35500, 38200, 41000, 43900, 46900, 50000,  // 21-30 (Bounty Hunter prestige)
];

// Role definitions - ORDERED BY OPTIMAL UNLOCK PROGRESSION
// 1. Collector: Easiest passive XP/money, no combat required
// 2. Trader: Camp deliveries, synergizes with hunting
// 3. Bounty Hunter: Only role that earns Gold Bars, essential for unlocking other roles
// 4. Moonshiner: Requires Trader Rank 5, bootlegging missions
// 5. Naturalist: Late game, conflicts with Trader hunting
const ROLES = {
  collector: { name: 'Collector', color: 'text-violet-400', bg: 'bg-violet-500', icon: Compass, maxLevel: 20, unlockCost: 15, desc: 'Best passive income' },
  trader: { name: 'Trader', color: 'text-amber-500', bg: 'bg-amber-500', icon: Box, maxLevel: 20, unlockCost: 15, desc: 'Camp supply runs' },
  bountyHunter: { name: 'Bounty Hunter', color: 'text-red-400', bg: 'bg-red-500', icon: Skull, maxLevel: 30, unlockCost: 15, desc: 'Earns Gold Bars' },
  moonshiner: { name: 'Moonshiner', color: 'text-cyan-400', bg: 'bg-cyan-500', icon: Wine, maxLevel: 20, unlockCost: 25, desc: 'Requires Trader 5' },
  naturalist: { name: 'Naturalist', color: 'text-emerald-400', bg: 'bg-emerald-500', icon: Leaf, maxLevel: 20, unlockCost: 25, desc: 'Sampling & sedation' },
};

// Helper: Calculate level from XP
const getLevelFromXP = (xp, isRole = false, maxLevel = 100) => {
  const table = isRole ? ROLE_XP_TABLE : RANK_XP_TABLE;
  let level = 1;
  for (let i = 1; i < Math.min(table.length, maxLevel + 1); i++) {
    if (xp >= table[i]) level = i;
    else break;
  }
  return Math.min(level, maxLevel);
};

// Helper: Get XP progress within current level
const getXPProgress = (xp, isRole = false, maxLevel = 100) => {
  const table = isRole ? ROLE_XP_TABLE : RANK_XP_TABLE;
  const level = getLevelFromXP(xp, isRole, maxLevel);
  if (level >= maxLevel || level >= table.length - 1) return { current: 0, needed: 0, percent: 100 };
  
  const currentLevelXP = table[level];
  const nextLevelXP = table[level + 1];
  const xpIntoLevel = xp - currentLevelXP;
  const xpNeeded = nextLevelXP - currentLevelXP;
  
  return {
    current: xpIntoLevel,
    needed: xpNeeded,
    percent: Math.min(100, (xpIntoLevel / xpNeeded) * 100)
  };
};

// =========================================================================
// MASTER CATALOG - ALL PURCHASABLE ITEMS IN RDO
// Sources: GTABase.com, Rockstar Newswire, Jean Ropke Map
// Last verified: January 2025
// =========================================================================

const CATALOG = [
  // ===== WEAPONS - REVOLVERS (Verified from GTABase) =====
  { id: 'w001', type: 'weapon', category: 'Revolver', name: 'Cattleman Revolver', price: 50, gold: 0, rank: 1, priority: 'starter', desc: 'Standard issue revolver. Reliable and accurate.' },
  { id: 'w002', type: 'weapon', category: 'Revolver', name: 'Schofield Revolver', price: 192, gold: 0, rank: 9, priority: 'recommended', desc: 'Higher damage than Cattleman. Slower fire rate.' },
  { id: 'w003', type: 'weapon', category: 'Revolver', name: 'Double-Action Revolver', price: 127, gold: 0, rank: 1, priority: 'optional', desc: 'Fast firing. Lower damage per shot.' },
  { id: 'w004', type: 'weapon', category: 'Revolver', name: 'Navy Revolver', price: 275, gold: 0, rank: 1, priority: 'essential', desc: 'BEST sidearm stats. Holster for 10s bypasses slow reload. META.' },
  { id: 'w005', type: 'weapon', category: 'Revolver', name: 'LeMat Revolver', price: 317, gold: 0, rank: 1, priority: 'recommended', desc: '9 rounds + 1 shotgun shell. Auto-switches between. Great versatility.' },
  { id: 'w006', type: 'weapon', category: 'Revolver', name: 'High Roller Double-Action', price: 190, gold: 0, rank: 1, priority: 'optional', desc: 'Ornate variant of Double-Action. Same stats.' },

  // ===== WEAPONS - PISTOLS (Verified from GTABase) =====
  { id: 'w007', type: 'weapon', category: 'Pistol', name: 'Volcanic Pistol', price: 270, gold: 0, rank: 1, priority: 'optional', desc: 'High damage semi-auto. Slow fire rate.' },
  { id: 'w008', type: 'weapon', category: 'Pistol', name: 'Semi-Automatic Pistol', price: 537, gold: 0, rank: 22, priority: 'recommended', desc: 'Fast firing modern pistol. 8-round magazine.' },
  { id: 'w009', type: 'weapon', category: 'Pistol', name: 'Mauser Pistol', price: 450, gold: 0, rank: 34, priority: 'recommended', desc: '10-round magazine. Very fast reload.' },
  { id: 'w010', type: 'weapon', category: 'Pistol', name: 'M1899 Pistol', price: 350, gold: 0, rank: 56, priority: 'luxury', desc: 'Fastest firing pistol. Low damage.' },

  // ===== WEAPONS - REPEATERS (Verified from GTABase) =====
  { id: 'w011', type: 'weapon', category: 'Repeater', name: 'Carbine Repeater', price: 90, gold: 0, rank: 1, priority: 'starter', desc: 'Starter repeater. Balanced stats.' },
  { id: 'w012', type: 'weapon', category: 'Repeater', name: 'Lancaster Repeater', price: 243, gold: 0, rank: 12, priority: 'essential', desc: 'Best accuracy repeater. 14-round tube. META weapon.' },
  { id: 'w013', type: 'weapon', category: 'Repeater', name: 'Litchfield Repeater', price: 348, gold: 0, rank: 18, priority: 'optional', desc: 'Highest damage repeater. Poor accuracy.' },
  { id: 'w014', type: 'weapon', category: 'Repeater', name: 'Evans Repeater', price: 300, gold: 0, rank: 1, priority: 'optional', desc: '26-round capacity. Longest reload.' },

  // ===== WEAPONS - RIFLES (Verified from GTABase) =====
  { id: 'w015', type: 'weapon', category: 'Rifle', name: 'Springfield Rifle', price: 156, gold: 0, rank: 1, priority: 'recommended', desc: 'Single-shot rifle. High damage.' },
  { id: 'w016', type: 'weapon', category: 'Rifle', name: 'Bolt Action Rifle', price: 216, gold: 0, rank: 7, priority: 'essential', desc: '5-round internal magazine. Versatile. META for hunting.' },
  { id: 'w017', type: 'weapon', category: 'Rifle', name: 'Varmint Rifle', price: 72, gold: 0, rank: 8, priority: 'essential', desc: 'Small game hunting. Required for perfect pelts.' },
  { id: 'w018', type: 'weapon', category: 'Rifle', name: 'Rolling Block Rifle', price: 411, gold: 0, rank: 13, priority: 'recommended', desc: 'Sniper rifle. Highest damage single shot.' },
  { id: 'w019', type: 'weapon', category: 'Rifle', name: 'Carcano Rifle', price: 456, gold: 0, rank: 50, priority: 'essential', desc: '6-round sniper. META PvP weapon.' },
  { id: 'w020', type: 'weapon', category: 'Rifle', name: 'Elephant Rifle', price: 0, gold: 19, rank: 1, priority: 'luxury', desc: 'Naturalist role. Extreme damage. Two-shot before reload.', role: 'naturalist' },

  // ===== WEAPONS - SHOTGUNS (Verified from GTABase) =====
  { id: 'w021', type: 'weapon', category: 'Shotgun', name: 'Double-Barrel Shotgun', price: 185, gold: 0, rank: 1, priority: 'optional', desc: '2 shells. High burst damage.' },
  { id: 'w022', type: 'weapon', category: 'Shotgun', name: 'Pump Shotgun', price: 266, gold: 0, rank: 5, priority: 'essential', desc: 'Better range than Semi-Auto. 5-round tube. Reliable close combat.' },
  { id: 'w023', type: 'weapon', category: 'Shotgun', name: 'Repeating Shotgun', price: 434, gold: 0, rank: 11, priority: 'optional', desc: '6-round tube. Fastest firing.' },
  { id: 'w024', type: 'weapon', category: 'Shotgun', name: 'Semi-Auto Shotgun', price: 495, gold: 0, rank: 42, priority: 'recommended', desc: 'Fastest hip-fire shotgun. 5 quick shots. Great for PIB builds.' },
  { id: 'w025', type: 'weapon', category: 'Shotgun', name: 'Sawed-Off Shotgun', price: 111, gold: 0, rank: 19, priority: 'recommended', desc: 'Sidearm slot shotgun! Dual wield with Navy for versatility.' },

  // ===== WEAPONS - BOW & MELEE (Verified from GTABase) =====
  { id: 'w026', type: 'weapon', category: 'Bow', name: 'Bow', price: 124, gold: 0, rank: 1, priority: 'essential', desc: 'Silent hunting weapon. Required for Trader.' },
  { id: 'w027', type: 'weapon', category: 'Bow', name: 'Improved Bow', price: 275, gold: 0, rank: 1, priority: 'essential', desc: 'Faster draw. Counters Slippery Bastard with PIB. Stealth hunting.', role: 'naturalist' },
  { id: 'w028', type: 'weapon', category: 'Melee', name: 'Machete', price: 0, gold: 5, rank: 1, priority: 'optional', desc: 'Longer reach melee.' },
  { id: 'w029', type: 'weapon', category: 'Melee', name: 'Hatchet', price: 4.25, gold: 0, rank: 28, priority: 'optional', desc: 'Small axe. Can throw.' },
  { id: 'w030', type: 'weapon', category: 'Thrown', name: 'Bolas', price: 30, gold: 0, rank: 1, priority: 'recommended', desc: 'Bounty Hunter role. Trips targets.', role: 'bountyHunter' },
  { id: 'w031', type: 'weapon', category: 'Thrown', name: 'Reinforced Lasso', price: 350, gold: 0, rank: 1, priority: 'essential', desc: 'Bounty Hunter role. Cannot be cut.', role: 'bountyHunter' },
  { id: 'w032', type: 'weapon', category: 'Melee', name: 'Hammer', price: 75, gold: 0, rank: 1, priority: 'optional', desc: 'Trader role melee weapon.', role: 'trader' },
  { id: 'w033', type: 'weapon', category: 'Melee', name: 'Águila Machete', price: 150, gold: 0, rank: 1, priority: 'optional', desc: 'Collector role machete.', role: 'collector' },

  // ===== HORSES - WORK (Verified prices from GTABase) =====
  { id: 'h001', type: 'horse', category: 'Draft', name: 'Belgian Draft', price: 120, gold: 0, rank: 1, priority: 'starter', desc: 'Strong work horse. Low speed.' },
  { id: 'h002', type: 'horse', category: 'Draft', name: 'Shire', price: 130, gold: 0, rank: 1, priority: 'optional', desc: 'Largest horse. High health.' },

  // ===== HORSES - RIDING =====
  { id: 'h003', type: 'horse', category: 'Riding', name: 'Morgan', price: 55, gold: 0, rank: 1, priority: 'starter', desc: 'Starter riding horse.' },
  { id: 'h004', type: 'horse', category: 'Riding', name: 'Kentucky Saddler', price: 50, gold: 0, rank: 1, priority: 'starter', desc: 'Balanced riding horse.' },
  { id: 'h005', type: 'horse', category: 'Riding', name: 'Mustang (Wild Bay)', price: 500, gold: 0, rank: 56, priority: 'recommended', desc: 'Brave horse. War class. High health.' },

  // ===== HORSES - RACE =====
  { id: 'h006', type: 'horse', category: 'Race', name: 'American Standardbred', price: 400, gold: 0, rank: 21, priority: 'recommended', desc: 'Fast race horse. High stamina.' },
  { id: 'h007', type: 'horse', category: 'Race', name: 'Thoroughbred', price: 450, gold: 0, rank: 26, priority: 'recommended', desc: 'Top speed race horse.' },
  { id: 'h008', type: 'horse', category: 'Race', name: 'Norfolk Roadster (Spotted Tri)', price: 950, gold: 0, rank: 20, priority: 'recommended', desc: 'Moonshiner role. Best stamina in game.' },

  // ===== HORSES - MULTI-CLASS (Verified from GTABase) =====
  { id: 'h009', type: 'horse', category: 'Multi', name: 'Missouri Fox Trotter (Amber Champ.)', price: 1125, gold: 0, rank: 54, priority: 'essential', desc: 'Best all-rounder. Speed + Health. META horse.' },
  { id: 'h010', type: 'horse', category: 'Multi', name: 'Missouri Fox Trotter (Silver Dapple)', price: 950, gold: 0, rank: 58, priority: 'essential', desc: 'Alternative MFT coat. Same great stats.' },
  { id: 'h011', type: 'horse', category: 'Multi', name: 'Turkoman (Dark Bay)', price: 925, gold: 0, rank: 54, priority: 'recommended', desc: 'War/Race hybrid. High health.' },
  { id: 'h012', type: 'horse', category: 'Multi', name: 'Turkoman (Gold)', price: 950, gold: 0, rank: 58, priority: 'recommended', desc: 'War/Race hybrid. Gold coat variant.' },
  { id: 'h013', type: 'horse', category: 'Multi', name: 'Turkoman (Silver)', price: 1000, gold: 0, rank: 60, priority: 'recommended', desc: 'Best Turkoman stats. Silver coat.' },

  // ===== HORSES - ARABIANS (Verified from GTABase) =====
  { id: 'h014', type: 'horse', category: 'Arabian', name: 'Arabian (Red Chestnut)', price: 250, gold: 0, rank: 1, priority: 'recommended', desc: 'Elite handling. Skittish but fast.' },
  { id: 'h015', type: 'horse', category: 'Arabian', name: 'Arabian (White)', price: 1200, gold: 0, rank: 66, priority: 'luxury', desc: 'Highest speed Arabian. Very skittish.' },
  { id: 'h016', type: 'horse', category: 'Arabian', name: 'Arabian (Rose Grey Bay)', price: 1250, gold: 0, rank: 68, priority: 'luxury', desc: 'Best Arabian stats. Top tier.' },
  { id: 'h017', type: 'horse', category: 'Arabian', name: 'Black Arabian', price: 1050, gold: 42, rank: 64, priority: 'luxury', desc: 'Can be bought with Gold. Great handling.' },

  // ===== ROLE HORSES (Verified from GTABase) =====
  { id: 'h018', type: 'horse', category: 'Role', name: 'Criollo (Bounty Hunter)', price: 150, gold: 0, rank: 1, priority: 'recommended', desc: 'Bounty Hunter role horse. Good stamina.', role: 'bountyHunter' },
  { id: 'h019', type: 'horse', category: 'Role', name: 'Breton (Bounty Hunter)', price: 950, gold: 0, rank: 20, priority: 'essential', desc: 'Bounty Hunter Rank 20. War class. Very brave.', role: 'bountyHunter' },
  { id: 'h020', type: 'horse', category: 'Role', name: 'Kladruber (Trader)', price: 150, gold: 0, rank: 1, priority: 'recommended', desc: 'Trader role horse. High health.', role: 'trader' },
  { id: 'h021', type: 'horse', category: 'Role', name: 'Gypsy Cob (Trader)', price: 950, gold: 0, rank: 20, priority: 'essential', desc: 'Trader Rank 20. Draft class. Most health in game.', role: 'trader' },

  // ===== SADDLES (Community verified) =====
  { id: 's001', type: 'saddle', category: 'Standard', name: 'Alligator Ranch Cutter', price: 115, gold: 0, rank: 1, priority: 'starter', desc: 'Entry level saddle. +16% stamina.' },
  { id: 's002', type: 'saddle', category: 'Standard', name: 'Panther Trail', price: 175, gold: 0, rank: 26, priority: 'recommended', desc: 'Panther skin. +24% stamina.' },
  { id: 's003', type: 'saddle', category: 'Special', name: 'Nacogdoches Saddle', price: 512, gold: 0, rank: 35, priority: 'essential', desc: 'BEST SADDLE. +35% regen, -50% core drain. META.' },
  { id: 's004', type: 'saddle', category: 'Role', name: 'Bounty Hunter Saddle', price: 0, gold: 0, rank: 1, priority: 'recommended', desc: 'Bounty Hunter role. Good stats.', role: 'bountyHunter' },
  { id: 's005', type: 'saddle', category: 'Role', name: 'Collector Saddle', price: 0, gold: 0, rank: 1, priority: 'recommended', desc: 'Collector role. Saddlebag capacity.', role: 'collector' },
  { id: 's006', type: 'saddle', category: 'Role', name: 'Trader Saddle', price: 0, gold: 0, rank: 1, priority: 'recommended', desc: 'Trader role. Great for long hauls.', role: 'trader' },

  // ===== STIRRUPS (Verified from GTABase) =====
  { id: 't001', type: 'tack', category: 'Stirrups', name: 'Hooded Stirrups', price: 75, gold: 0, rank: 1, priority: 'starter', desc: '+2% speed/accel.' },
  { id: 't002', type: 'tack', category: 'Stirrups', name: 'Reinforced Stirrups', price: 210, gold: 0, rank: 60, priority: 'essential', desc: '+4% speed/accel. Best non-role.' },
  { id: 't003', type: 'tack', category: 'Stirrups', name: 'Delgado Saddle', price: 495, gold: 0, rank: 35, priority: 'recommended', desc: 'Second best saddle. +34% regen.' },

  // ===== ROLE LICENSES (Verified costs) =====
  { id: 'r001', type: 'role', category: 'License', name: 'Bounty Hunter License', price: 0, gold: 15, rank: 1, priority: 'essential', desc: 'ONLY role that earns gold. Start here.' },
  { id: 'r002', type: 'role', category: 'License', name: 'Trader (Butcher Table)', price: 0, gold: 15, rank: 1, priority: 'essential', desc: 'Best passive income. Camp business.' },
  { id: 'r003', type: 'role', category: 'License', name: 'Collector Bag', price: 0, gold: 15, rank: 1, priority: 'essential', desc: 'Highest cash/hour if using Jean Ropke map.' },
  { id: 'r004', type: 'role', category: 'License', name: 'Moonshiner Shack', price: 0, gold: 25, rank: 5, priority: 'recommended', desc: 'Requires Trader Rank 5. Good passive.' },
  { id: 'r005', type: 'role', category: 'License', name: 'Naturalist Sample Kit', price: 0, gold: 25, rank: 1, priority: 'optional', desc: 'Harriet role. Least profitable.' },
  { id: 'r006', type: 'role', category: 'License', name: 'Prestigious BH License', price: 0, gold: 15, rank: 1, priority: 'recommended', desc: 'Extends Bounty Hunter to Rank 30.', role: 'bountyHunter' },

  // ===== COLLECTOR TOOLS (Verified from Reddit FAQ - SmurfinGTA Guide) =====
  // Note: Purchased from Madam Nazar for CASH, not Gold
  { id: 'c001', type: 'tool', category: 'Collector', name: 'Shovel', price: 350, gold: 0, rank: 1, priority: 'essential', desc: 'Dig up buried items. Required for coins.', role: 'collector' },
  { id: 'c002', type: 'tool', category: 'Collector', name: 'Metal Detector', price: 700, gold: 0, rank: 5, priority: 'essential', desc: 'Find jewelry/coins/fossils. HUGE money maker.', role: 'collector' },
  { id: 'c003', type: 'tool', category: 'Collector', name: 'Refined Binoculars', price: 450, gold: 0, rank: 5, priority: 'recommended', desc: 'Eagle Eye built-in. Spot dig sites from afar.', role: 'collector' },
  { id: 'c004', type: 'tool', category: 'Collector', name: 'Horse Lantern', price: 350, gold: 0, rank: 10, priority: 'optional', desc: 'Night collecting. Attach to saddle.', role: 'collector' },
  { id: 'c005', type: 'tool', category: 'Collector', name: 'Collector Saddlebag', price: 125, gold: 0, rank: 5, priority: 'recommended', desc: 'More outfit storage on horse.', role: 'collector' },

  // ===== NATURALIST TOOLS =====
  { id: 'c006', type: 'tool', category: 'Naturalist', name: 'Varmint Sedative Ammo', price: 0, gold: 0, rank: 1, priority: 'essential', desc: 'Sedate small animals for sampling.', role: 'naturalist' },
  { id: 'c007', type: 'tool', category: 'Naturalist', name: 'Advanced Camera', price: 0, gold: 0, rank: 1, priority: 'recommended', desc: 'Better wildlife photography.', role: 'naturalist' },

  // ===== TRADER UPGRADES =====
  { id: 'c008', type: 'tool', category: 'Trader', name: 'Medium Delivery Wagon', price: 500, gold: 0, rank: 5, priority: 'essential', desc: '50 goods capacity. Trader Rank 5.', role: 'trader' },
  { id: 'c009', type: 'tool', category: 'Trader', name: 'Large Delivery Wagon', price: 750, gold: 0, rank: 10, priority: 'essential', desc: '100 goods capacity. Trader Rank 10.', role: 'trader' },
  { id: 'c010', type: 'tool', category: 'Trader', name: 'Hunting Wagon', price: 875, gold: 0, rank: 10, priority: 'essential', desc: 'Store 5 large pelts/carcasses. Persists in missions.', role: 'trader' },
  { id: 'c011', type: 'tool', category: 'Trader', name: 'Stew Pot', price: 650, gold: 0, rank: 1, priority: 'recommended', desc: 'Cook special stews for gold cores.', role: 'trader' },

  // ===== MOONSHINER UPGRADES =====
  { id: 'c012', type: 'tool', category: 'Moonshiner', name: 'Condenser Upgrade', price: 825, gold: 0, rank: 1, priority: 'essential', desc: 'Faster moonshine brewing.', role: 'moonshiner' },
  { id: 'c013', type: 'tool', category: 'Moonshiner', name: 'Polished Copper Upgrade', price: 875, gold: 0, rank: 1, priority: 'essential', desc: 'Highest tier moonshine ($226/batch).', role: 'moonshiner' },
  { id: 'c014', type: 'tool', category: 'Moonshiner', name: 'Bar Expansion', price: 950, gold: 0, rank: 1, priority: 'optional', desc: 'Band plays in your shack bar.', role: 'moonshiner' },

  // ===== ABILITY CARDS (Community verified) =====
  { id: 'a001', type: 'ability', category: 'Dead Eye', name: 'Paint It Black', price: 0, gold: 0, rank: 1, priority: 'essential', desc: 'Free. Best PvE card. Auto-headshots.' },
  { id: 'a002', type: 'ability', category: 'Dead Eye', name: 'Slow and Steady', price: 0, gold: 0, rank: 24, priority: 'recommended', desc: 'Tank build. Cannot be headshot in Dead Eye.' },
  { id: 'a003', type: 'ability', category: 'Dead Eye', name: 'Slippery Bastard', price: 0, gold: 0, rank: 36, priority: 'optional', desc: 'PvP evasion. Enemies cant lock on.' },
  { id: 'a004', type: 'ability', category: 'Dead Eye', name: 'Focus Fire', price: 0, gold: 0, rank: 50, priority: 'optional', desc: 'Team damage buff. PvP group play.' },
  { id: 'a005', type: 'ability', category: 'Passive', name: 'Winning Streak', price: 50, gold: 0, rank: 1, priority: 'essential', desc: 'Consecutive hits deal more damage.' },
  { id: 'a006', type: 'ability', category: 'Passive', name: 'Peak Condition', price: 50, gold: 0, rank: 1, priority: 'recommended', desc: 'More damage at full stamina.' },
  { id: 'a007', type: 'ability', category: 'Passive', name: 'Iron Lung', price: 50, gold: 0, rank: 1, priority: 'recommended', desc: 'More stamina, less drain.' },
  { id: 'a008', type: 'ability', category: 'Passive', name: 'Never Without One', price: 350, gold: 0, rank: 46, priority: 'essential', desc: 'Hat blocks headshot. META PvP.' },
  { id: 'a009', type: 'ability', category: 'Passive', name: 'Cold Blooded', price: 50, gold: 0, rank: 1, priority: 'recommended', desc: 'Health regen on kills. Great for PvE.' },
  { id: 'a010', type: 'ability', category: 'Passive', name: 'Strange Medicine', price: 50, gold: 0, rank: 1, priority: 'recommended', desc: 'Health regen on damage. Sustain build.' },
  { id: 'a011', type: 'ability', category: 'Passive', name: 'Fool Me Once', price: 50, gold: 0, rank: 1, priority: 'recommended', desc: 'Damage reduction on consecutive hits.' },
  { id: 'a012', type: 'ability', category: 'Upgrade', name: 'Card Upgrade (Tier 2)', price: 350, gold: 0, rank: 1, priority: 'recommended', desc: 'Upgrade any card to Tier 2.' },
  { id: 'a013', type: 'ability', category: 'Upgrade', name: 'Card Upgrade (Tier 3)', price: 500, gold: 0, rank: 1, priority: 'recommended', desc: 'Upgrade any card to Tier 3 (max).' },

  // ===== CAMP UPGRADES =====
  { id: 'u001', type: 'camp', category: 'Tent', name: 'Lean-To Tent', price: 0, gold: 0, rank: 1, priority: 'starter', desc: 'Default tent.' },
  { id: 'u002', type: 'camp', category: 'Tent', name: 'Covered Tent', price: 85, gold: 0, rank: 1, priority: 'optional', desc: 'Better weather protection.' },
  { id: 'u003', type: 'camp', category: 'Tent', name: 'Large Tent', price: 175, gold: 0, rank: 64, priority: 'luxury', desc: 'Biggest tent. Status symbol.' },
  { id: 'u004', type: 'camp', category: 'Utility', name: 'Fast Travel Post', price: 0, gold: 0, rank: 1, priority: 'essential', desc: 'Free fast travel FROM camp. Huge QoL.' },
  { id: 'u005', type: 'camp', category: 'Utility', name: 'Stew Pot', price: 650, gold: 0, rank: 1, priority: 'recommended', desc: 'Cook stew for gold core rings.' },
  { id: 'u006', type: 'camp', category: 'Utility', name: 'Weapons Locker', price: 0, gold: 0, rank: 1, priority: 'recommended', desc: 'Hide weapons from weapon wheel.' },
  { id: 'u007', type: 'camp', category: 'Dog', name: 'Camp Dog', price: 0, gold: 15, rank: 1, priority: 'optional', desc: 'Warns of raids. Good boy.' },

  // ===== PAMPHLETS (CRAFTING RECIPES) =====
  { id: 'p001', type: 'pamphlet', category: 'Ammo', name: 'Small Game Arrows', price: 350, gold: 0, rank: 22, priority: 'essential', desc: 'Perfect small pelts. Required for Trader.' },
  { id: 'p002', type: 'pamphlet', category: 'Ammo', name: 'Poison Arrows', price: 450, gold: 0, rank: 36, priority: 'optional', desc: 'Damage over time arrows.' },
  { id: 'p003', type: 'pamphlet', category: 'Ammo', name: 'Fire Arrows', price: 500, gold: 0, rank: 44, priority: 'optional', desc: 'Incendiary arrows.' },
  { id: 'p004', type: 'pamphlet', category: 'Ammo', name: 'Explosive Express', price: 950, gold: 0, rank: 90, priority: 'luxury', desc: 'Explosive bullets. Endgame grief tool.' },
  { id: 'p005', type: 'pamphlet', category: 'Ammo', name: 'Explosive Slug', price: 850, gold: 0, rank: 82, priority: 'luxury', desc: 'Explosive shotgun rounds.' },
  { id: 'p006', type: 'pamphlet', category: 'Tonic', name: 'Special Health Cure', price: 450, gold: 0, rank: 48, priority: 'recommended', desc: 'Best craftable health tonic.' },
  { id: 'p007', type: 'pamphlet', category: 'Tonic', name: 'Special Snake Oil', price: 580, gold: 0, rank: 64, priority: 'recommended', desc: 'Best Dead Eye tonic.' },

  // ===== CLOTHING ESSENTIALS =====
  { id: 'cl01', type: 'clothing', category: 'Hat', name: 'Stalker Hat', price: 12, gold: 0, rank: 8, priority: 'starter', desc: 'Classic cowboy hat.' },
  { id: 'cl02', type: 'clothing', category: 'Coat', name: 'Duster Coat', price: 42, gold: 0, rank: 15, priority: 'recommended', desc: 'Long riding coat. Iconic look.' },
  { id: 'cl03', type: 'clothing', category: 'Accessory', name: 'Bandolier', price: 0, gold: 8, rank: 1, priority: 'essential', desc: '+10 rifle ammo capacity.' },
  { id: 'cl04', type: 'clothing', category: 'Accessory', name: 'Off-Hand Holster', price: 0, gold: 0, rank: 25, priority: 'essential', desc: 'Dual wield sidearms. Free at rank 25.' },

  // ===== CONSUMABLES WORTH BUYING =====
  { id: 'i001', type: 'item', category: 'Consumable', name: 'Gun Oil (x5)', price: 10, gold: 0, rank: 1, priority: 'essential', desc: 'Keep weapons clean. Always stock up.' },
  { id: 'i002', type: 'item', category: 'Consumable', name: 'Horse Reviver (x5)', price: 40, gold: 0, rank: 1, priority: 'essential', desc: 'Save your horse. Always carry.' },
  { id: 'i003', type: 'item', category: 'Lure', name: 'Lake Lure', price: 2.50, gold: 0, rank: 1, priority: 'recommended', desc: 'Catch large lake fish. Reusable.' },
  { id: 'i004', type: 'item', category: 'Lure', name: 'River Lure', price: 2.50, gold: 0, rank: 1, priority: 'recommended', desc: 'Catch large river fish. Reusable.' },

  // ===== FAST TRAVEL NOTE =====
  // Fast travel prices are calculated dynamically based on distance
  // Use the Fast Travel Calculator component for accurate pricing
  // Current promo (Dec 2024): All fast travel is FREE
];

// =========================================================================
// PRIORITY DEFINITIONS - ENHANCED WITH GRADIENTS
// =========================================================================

const PRIORITY_CONFIG = {
  essential: { 
    label: 'Essential', 
    emoji: '⚡',
    color: 'text-emerald-300/90', 
    bg: 'bg-emerald-950/60', 
    border: 'border-emerald-700/40', 
    glow: 'shadow-emerald-900/30',
    order: 1, 
    desc: 'Must-have items. Buy these first.',
    icon: Zap
  },
  recommended: { 
    label: 'Recommended', 
    emoji: '⭐',
    color: 'text-sky-300/90', 
    bg: 'bg-sky-950/60', 
    border: 'border-sky-700/40', 
    glow: 'shadow-sky-900/30',
    order: 2, 
    desc: 'Strong upgrades. Good value.',
    icon: Sparkles
  },
  optional: { 
    label: 'Optional', 
    emoji: '👍',
    color: 'text-amber-300/90', 
    bg: 'bg-amber-950/60', 
    border: 'border-amber-700/40', 
    glow: 'shadow-amber-900/30',
    order: 3, 
    desc: 'Nice to have. Not urgent.',
    icon: Star
  },
  luxury: { 
    label: 'Luxury', 
    emoji: '💎',
    color: 'text-fuchsia-300/90', 
    bg: 'bg-fuchsia-950/60', 
    border: 'border-fuchsia-700/40', 
    glow: 'shadow-fuchsia-900/30',
    order: 4, 
    desc: 'Endgame/cosmetic. When rich.',
    icon: Award
  },
  starter: { 
    label: 'Starter', 
    emoji: '🌱',
    color: 'text-zinc-400/90', 
    bg: 'bg-zinc-900/60', 
    border: 'border-zinc-700/40', 
    glow: 'shadow-zinc-800/30',
    order: 5, 
    desc: 'Free or default items.',
    icon: Package
  },
};

// =========================================================================
// TYPE CATEGORIES WITH ICONS - FOR NAVIGATION
// =========================================================================

const TYPE_CONFIG = {
  weapon: { label: 'Weapons', icon: Crosshair, color: 'text-red-300/80', bg: 'bg-red-950/50' },
  horse: { label: 'Horses', icon: Compass, color: 'text-amber-300/80', bg: 'bg-amber-950/50' },
  saddle: { label: 'Saddles', icon: Box, color: 'text-orange-300/80', bg: 'bg-orange-950/50' },
  tack: { label: 'Tack', icon: Box, color: 'text-yellow-300/80', bg: 'bg-yellow-950/50' },
  role: { label: 'Roles', icon: Target, color: 'text-violet-300/80', bg: 'bg-violet-950/50' },
  tool: { label: 'Tools', icon: Compass, color: 'text-cyan-300/80', bg: 'bg-cyan-950/50' },
  ability: { label: 'Abilities', icon: Zap, color: 'text-blue-300/80', bg: 'bg-blue-950/50' },
  camp: { label: 'Camp', icon: Tent, color: 'text-emerald-300/80', bg: 'bg-emerald-950/50' },
  pamphlet: { label: 'Pamphlets', icon: ScrollText, color: 'text-indigo-300/80', bg: 'bg-indigo-950/50' },
  clothing: { label: 'Clothing', icon: Shirt, color: 'text-rose-300/80', bg: 'bg-rose-950/50' },
  item: { label: 'Items', icon: Package, color: 'text-zinc-400/80', bg: 'bg-zinc-800/50' },
  // Fast Travel is now handled by FastTravelCalculator component
};

// =========================================================================
// PLAYER PROFILE COMPONENT (MAIN FEATURE) - WITH XP TRACKING
// =========================================================================

// Progress Bar Component - ENHANCED WITH ANIMATION
function ProgressBar({ percent, color, height = 'h-2', animated = true }) {
  return (
    <div className={`w-full ${height} bg-white/10 rounded-full overflow-hidden backdrop-blur-sm`}>
      <div 
        className={`${height} ${color} rounded-full transition-all duration-500 ease-out ${animated ? 'animate-pulse' : ''}`}
        style={{ width: `${Math.min(100, percent)}%` }}
      />
    </div>
  );
}

// Role Progress Card Component - ENHANCED WITH PROMINENT XP INPUT
function RoleProgressCard({ roleKey, role, xp, onXPChange }) {
  const Icon = role.icon;
  const level = getLevelFromXP(xp, true, role.maxLevel);
  const progress = getXPProgress(xp, true, role.maxLevel);
  const isMaxed = level >= role.maxLevel;
  const nextLevelXP = !isMaxed && level < ROLE_XP_TABLE.length - 1 ? ROLE_XP_TABLE[level + 1] : null;
  
  return (
    <div className={`relative bg-gradient-to-br from-[#0a0a0a] via-[#0d0d0d] to-[#080808] rounded-xl p-4 border-2 ${isMaxed ? 'border-' + role.color.replace('text-', '') + '/50' : 'border-white/10'} hover:border-white/30 transition-all duration-300 hover:shadow-xl hover:shadow-${role.color.replace('text-', '')}/20 group overflow-hidden`}>
      {/* Animated background glow */}
      <div className={`absolute inset-0 rounded-xl bg-gradient-to-br ${role.bg}/30 opacity-0 group-hover:opacity-50 transition-opacity duration-500`} />
      {isMaxed && <div className={`absolute inset-0 rounded-xl ${role.bg}/20 animate-pulse`} />}
      
      <div className="relative z-10">
        {/* Header: Role name + Level */}
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-2">
            <div className={`p-2 rounded-lg ${role.bg} shadow-lg shadow-${role.color.replace('text-', '')}/20`}>
              <Icon className={role.color} size={18} />
            </div>
            <div>
              <span className="text-sm font-bold text-white">{role.name}</span>
              {role.maxLevel > 20 && level > 20 && (
                <span className="ml-1 text-xs text-amber-400">★ Prestigious</span>
              )}
            </div>
          </div>
          <div className="text-right">
            <div className={`text-2xl font-black font-mono ${role.color} drop-shadow-lg`}>
              {level}
              {level >= 20 && role.maxLevel > 20 ? <span className="text-sm text-amber-400 ml-0.5">+</span> : ''}
            </div>
            <div className="text-[10px] text-gray-500 uppercase tracking-wider">Level</div>
          </div>
        </div>
        
        {/* XP Input Section - PROMINENT */}
        <div className="bg-black/40 rounded-lg p-3 mb-3 border border-white/5">
          <div className="flex items-center justify-between mb-2">
            <label className="text-xs text-gray-400 uppercase tracking-wider font-medium flex items-center gap-1">
              <Star size={10} className={role.color} />
              Role XP
            </label>
            {nextLevelXP && (
              <span className="text-[10px] text-gray-500">Next: {nextLevelXP.toLocaleString()}</span>
            )}
          </div>
          <input
            type="number"
            min="0"
            max="50000"
            value={xp}
            onChange={(e) => onXPChange(roleKey, Math.max(0, parseInt(e.target.value) || 0))}
            className={`w-full bg-black/60 border-2 border-white/10 hover:border-white/20 focus:border-${role.color.replace('text-', '')}/50 rounded-lg px-3 py-2 text-lg font-bold font-mono ${role.color} focus:outline-none focus:ring-2 focus:ring-${role.color.replace('text-', '')}/30 transition-all placeholder:text-gray-600`}
            placeholder="0"
          />
        </div>
        
        {/* Progress Bar - ENHANCED */}
        <div className="space-y-2">
          <div className="relative h-3 bg-black/50 rounded-full overflow-hidden border border-white/5">
            <div 
              className={`absolute inset-y-0 left-0 ${role.bg} rounded-full transition-all duration-700 ease-out ${!isMaxed ? 'animate-pulse' : ''}`}
              style={{ width: `${Math.min(100, progress.percent)}%` }}
            />
            {/* Shimmer effect */}
            <div 
              className="absolute inset-y-0 left-0 bg-gradient-to-r from-transparent via-white/20 to-transparent rounded-full"
              style={{ width: `${Math.min(100, progress.percent)}%`, animation: 'shimmer 2s infinite' }}
            />
          </div>
          
          {/* Progress stats */}
          <div className="flex justify-between items-center">
            {isMaxed ? (
              <span className={`${role.color} font-bold flex items-center gap-1 text-sm`}>
                <Award size={14} className="animate-bounce" /> MAX LEVEL!
              </span>
            ) : (
              <>
                <span className="text-xs text-gray-400 font-mono">
                  {progress.current.toLocaleString()} / {progress.needed.toLocaleString()} XP
                </span>
                <span className={`text-sm font-bold ${role.color}`}>{Math.round(progress.percent)}%</span>
              </>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

function PlayerProfile({ profile, setProfile }) {
  // Calculate overall rank from XP
  const overallLevel = getLevelFromXP(profile.xp, false, 100);
  const overallProgress = getXPProgress(profile.xp, false, 100);
  
  const handleRoleXPChange = (roleKey, newXP) => {
    setProfile(p => ({
      ...p,
      roles: { ...p.roles, [roleKey]: newXP }
    }));
  };

  return (
    <div className="relative bg-gradient-to-br from-[#1a1512] via-[#12100d] to-[#0d0a08] border border-[#D4AF37]/30 rounded-2xl p-8 mb-8 overflow-hidden">
      {/* Decorative background elements */}
      <div className="absolute top-0 right-0 w-64 h-64 bg-gradient-to-bl from-[#D4AF37]/5 to-transparent rounded-full blur-3xl" />
      <div className="absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-amber-900/10 to-transparent rounded-full blur-2xl" />
      
      <div className="relative z-10">
        {/* Header */}
        <div className="flex items-center gap-4 mb-8">
          <div className="relative">
            <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-[#D4AF37]/30 to-[#D4AF37]/10 flex items-center justify-center border border-[#D4AF37]/20 shadow-lg shadow-[#D4AF37]/10">
              <User className="text-[#D4AF37]" size={28} />
            </div>
            <div className="absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-[#D4AF37] flex items-center justify-center text-black text-xs font-bold">
              {overallLevel}
            </div>
          </div>
          <div>
            <h2 className="text-[#D4AF37] font-western text-3xl tracking-wide">Your Character</h2>
            <p className="text-gray-500 text-sm mt-1">Enter your XP and resources to simulate purchases</p>
          </div>
        </div>

        {/* Overall Rank with XP - ENHANCED */}
        <div className="relative bg-gradient-to-r from-[#0a0a0a] to-[#0d0906] rounded-xl p-5 border border-yellow-500/30 mb-6 overflow-hidden group hover:border-yellow-500/50 transition-all duration-300">
          <div className="absolute inset-0 bg-gradient-to-r from-yellow-500/5 to-orange-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
          
          <div className="relative z-10 flex items-center justify-between mb-4">
            <div className="flex items-center gap-4">
              <div className="p-3 rounded-xl bg-gradient-to-br from-yellow-500/20 to-orange-500/10 border border-yellow-500/20">
                <Star className="text-yellow-500" size={28} />
              </div>
              <div>
                <div className="text-xs text-gray-400 uppercase tracking-wider font-medium">Overall Rank</div>
                <div className="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-amber-500 font-mono tracking-tight">{overallLevel}</div>
              </div>
            </div>
            <div className="text-right">
              <div className="text-xs text-gray-400 uppercase tracking-wider mb-2">Total XP</div>
              <input
                type="number"
                min="0"
                value={profile.xp}
                onChange={(e) => setProfile(p => ({ ...p, xp: Math.max(0, parseInt(e.target.value) || 0), rank: getLevelFromXP(parseInt(e.target.value) || 0, false, 100) }))}
                className="w-36 bg-black/50 border border-yellow-500/20 rounded-lg px-4 py-2 text-xl font-mono text-yellow-400 text-right focus:outline-none focus:border-yellow-500/50 focus:ring-2 focus:ring-yellow-500/20 transition-all"
              />
            </div>
          </div>
          
          <ProgressBar percent={overallProgress.percent} color="bg-gradient-to-r from-yellow-500 to-amber-500" height="h-3" animated={overallLevel < 100} />
          
          <div className="flex justify-between mt-3 text-sm">
            {overallLevel >= 100 ? (
              <span className="text-yellow-500 font-bold flex items-center gap-2">
                <Sparkles size={16} /> MAX RANK - Prestige Available
              </span>
            ) : (
              <>
                <span className="text-gray-400">Progress to Rank {overallLevel + 1}</span>
                <span className="text-yellow-400 font-mono">{overallProgress.current.toLocaleString()} / {overallProgress.needed.toLocaleString()} XP</span>
              </>
            )}
          </div>
        </div>

        {/* Resources Row - MIRRORS RDO HUD: Tokens (left), Gold (center), Cash (right) */}
        <div className="grid grid-cols-3 gap-4 mb-8">
          {/* Role Tokens - LEFT (blue, matches RDO) */}
          <div className="group relative bg-gradient-to-br from-[#0a0a0a] to-[#0d0d0d] rounded-xl p-5 border border-blue-600/30 hover:border-blue-500/50 transition-all duration-300 overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-br from-blue-900/20 to-blue-950/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
            <div className="relative z-10">
              <div className="flex items-center gap-2 mb-3">
                <div className="p-2 rounded-lg bg-blue-600/20">
                  <Award className="text-blue-400" size={18} />
                </div>
                <label className="text-xs text-gray-400 uppercase tracking-wider font-medium">Role Tokens</label>
              </div>
              <input
                type="number"
                min="0"
                value={profile.tokens}
                onChange={(e) => setProfile(p => ({ ...p, tokens: Math.max(0, parseInt(e.target.value) || 0) }))}
                className="w-full bg-transparent text-3xl font-bold text-blue-400 font-mono focus:outline-none"
              />
            </div>
          </div>

          {/* Gold Bars - CENTER (yellow/gold, matches RDO) */}
          <div className="group relative bg-gradient-to-br from-[#0a0a0a] to-[#0d0d0d] rounded-xl p-5 border border-[#D4AF37]/30 hover:border-[#D4AF37]/50 transition-all duration-300 overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-br from-[#D4AF37]/10 to-amber-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
            <div className="relative z-10">
              <div className="flex items-center gap-2 mb-3">
                <div className="p-2 rounded-lg bg-[#D4AF37]/20">
                  <Coins className="text-[#D4AF37]" size={18} />
                </div>
                <label className="text-xs text-gray-400 uppercase tracking-wider font-medium">Gold Bars</label>
              </div>
              <input
                type="number"
                min="0"
                step="0.01"
                value={profile.gold}
                onChange={(e) => setProfile(p => ({ ...p, gold: Math.max(0, parseFloat(e.target.value) || 0) }))}
                className="w-full bg-transparent text-3xl font-bold text-[#D4AF37] font-mono focus:outline-none"
              />
            </div>
          </div>

          {/* Cash - RIGHT (white-ish to match RDO HUD) */}
          <div className="group relative bg-gradient-to-br from-[#0a0a0a] to-[#0d0d0d] rounded-xl p-5 border border-neutral-500/30 hover:border-neutral-400/50 transition-all duration-300 overflow-hidden">
            <div className="absolute inset-0 bg-gradient-to-br from-neutral-800/20 to-neutral-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
            <div className="relative z-10">
              <div className="flex items-center gap-2 mb-3">
                <div className="p-2 rounded-lg bg-neutral-600/20">
                  <DollarSign className="text-neutral-200" size={18} />
                </div>
                <label className="text-xs text-gray-400 uppercase tracking-wider font-medium">Cash</label>
              </div>
              <input
                type="number"
                min="0"
                step="0.01"
                value={profile.cash}
                onChange={(e) => setProfile(p => ({ ...p, cash: Math.max(0, parseFloat(e.target.value) || 0) }))}
                className="w-full bg-transparent text-3xl font-bold text-neutral-100 font-mono focus:outline-none"
              />
            </div>
          </div>
        </div>

        {/* Role Progress Section - ENHANCED */}
        <div className="border-t border-white/10 pt-8">
          <h3 className="text-white font-western text-xl mb-6 flex items-center gap-3">
            <div className="p-2 rounded-lg bg-[#D4AF37]/10">
              <Target className="text-[#D4AF37]" size={20} />
            </div>
            Role Progression
          </h3>
          <div className="grid grid-cols-2 lg:grid-cols-5 gap-4">
            {Object.entries(ROLES).map(([key, role]) => (
              <RoleProgressCard
                key={key}
                roleKey={key}
                role={role}
                xp={profile.roles[key] || 0}
                onXPChange={handleRoleXPChange}
              />
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

// =========================================================================
// FAST TRAVEL CALCULATOR COMPONENT
// =========================================================================

function FastTravelCalculator() {
  const [fromLocation, setFromLocation] = useState('valentine');
  const [toLocation, setToLocation] = useState('saintdenis');
  
  const travelableLocations = Object.entries(FAST_TRAVEL_LOCATIONS)
    .filter(([_, loc]) => !loc.free)
    .sort((a, b) => a[1].name.localeCompare(b[1].name));
  
  const baseCost = FAST_TRAVEL_PRICES[fromLocation]?.[toLocation] || 0;
  const currentCost = getCurrentFastTravelCost(fromLocation, toLocation);
  const distance = fromLocation !== toLocation 
    ? calcDistance(FAST_TRAVEL_LOCATIONS[fromLocation], FAST_TRAVEL_LOCATIONS[toLocation]).toFixed(1)
    : 0;

  return (
    <div className="bg-[#121212] border border-white/10 rounded-xl p-6">
      <h3 className="text-white font-western text-xl flex items-center gap-2 mb-4">
        <Train className="text-teal-400" size={20} />
        Fast Travel Calculator
      </h3>
      
      {/* Promo Banner */}
      {FAST_TRAVEL_PROMO.active && (
        <div className="bg-gradient-to-r from-emerald-900/40 to-green-900/20 border border-emerald-500/30 rounded-lg p-3 mb-4">
          <div className="flex items-center gap-2 text-emerald-400 font-bold text-sm">
            <Sparkles size={16} />
            {FAST_TRAVEL_PROMO.description}
          </div>
          <p className="text-emerald-300/70 text-xs mt-1">Expires: {FAST_TRAVEL_PROMO.expires}</p>
        </div>
      )}
      
      <div className="grid grid-cols-2 gap-4 mb-4">
        {/* From Location */}
        <div>
          <label className="text-xs text-gray-400 uppercase tracking-wider mb-2 block">From</label>
          <select
            value={fromLocation}
            onChange={(e) => setFromLocation(e.target.value)}
            className="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-3 py-2.5 text-gray-200 text-sm focus:outline-none focus:border-teal-500/50"
            style={{ colorScheme: 'dark' }}
          >
            {travelableLocations.map(([key, loc]) => (
              <option key={key} value={key} className="bg-[#1a1a1a]">
                {loc.name} ({loc.region})
              </option>
            ))}
          </select>
        </div>
        
        {/* To Location */}
        <div>
          <label className="text-xs text-gray-400 uppercase tracking-wider mb-2 block">To</label>
          <select
            value={toLocation}
            onChange={(e) => setToLocation(e.target.value)}
            className="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-3 py-2.5 text-gray-200 text-sm focus:outline-none focus:border-teal-500/50"
            style={{ colorScheme: 'dark' }}
          >
            {travelableLocations.map(([key, loc]) => (
              <option key={key} value={key} className="bg-[#1a1a1a]">
                {loc.name} ({loc.region})
              </option>
            ))}
          </select>
        </div>
      </div>
      
      {/* Cost Display */}
      <div className="bg-black/30 rounded-lg p-4 border border-white/5">
        <div className="flex justify-between items-center mb-2">
          <span className="text-gray-400 text-sm">Distance:</span>
          <span className="text-gray-300 font-mono">{distance} units</span>
        </div>
        <div className="flex justify-between items-center mb-2">
          <span className="text-gray-400 text-sm">Base Cost:</span>
          <span className={`font-mono font-bold ${FAST_TRAVEL_PROMO.active ? 'text-gray-500 line-through' : 'text-neutral-100'}`}>
            ${baseCost.toFixed(2)}
          </span>
        </div>
        <div className="flex justify-between items-center pt-2 border-t border-white/10">
          <span className="text-white font-bold">Current Cost:</span>
          <span className={`text-2xl font-bold font-mono ${currentCost === 0 ? 'text-emerald-400' : 'text-neutral-100'}`}>
            {currentCost === 0 ? 'FREE' : `$${currentCost.toFixed(2)}`}
          </span>
        </div>
      </div>
      
      {/* Quick Reference */}
      <div className="mt-4 pt-4 border-t border-white/10">
        <p className="text-xs text-gray-500 mb-2">Free Fast Travel Options:</p>
        <ul className="text-xs text-gray-400 space-y-1">
          <li>• <span className="text-teal-400">From Camp</span> - Requires Camp Fast Travel upgrade ($700)</li>
          <li>• <span className="text-teal-400">Wilderness Camp</span> - Requires Naturalist Role Rank 5</li>
          <li>• <span className="text-teal-400">Posse Leader's Camp</span> - If posse leader has upgrade</li>
        </ul>
      </div>
    </div>
  );
}

// =========================================================================
// STATS SUMMARY COMPONENT - ENHANCED
// =========================================================================

function StatsSummary({ profile, catalog }) {
  const stats = useMemo(() => {
    let canAfford = 0;
    let locked = 0;
    let totalCashNeeded = 0;
    let totalGoldNeeded = 0;
    
    const byPriority = { essential: [], recommended: [], optional: [], luxury: [], starter: [] };
    
    catalog.forEach(item => {
      const rankOk = profile.rank >= item.rank;
      const cashOk = profile.cash >= item.price;
      const goldOk = profile.gold >= item.gold;
      const affordable = rankOk && cashOk && goldOk;
      
      if (!rankOk) {
        locked++;
      } else if (affordable) {
        canAfford++;
      }
      
      if (!affordable && item.priority !== 'starter') {
        totalCashNeeded += item.price;
        totalGoldNeeded += item.gold;
        if (byPriority[item.priority]) {
          byPriority[item.priority].push(item);
        }
      }
    });
    
    return { canAfford, locked, totalCashNeeded, totalGoldNeeded, byPriority };
  }, [profile, catalog]);

  return (
    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <div className="group relative bg-gradient-to-br from-[#121212] to-[#0d0d0d] rounded-xl p-5 border border-emerald-500/30 hover:border-emerald-500/50 transition-all duration-300 overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-green-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
        <div className="relative z-10">
          <div className="flex items-center gap-2 mb-2">
            <div className="p-1.5 rounded-lg bg-emerald-500/20">
              <Unlock className="text-emerald-400" size={16} />
            </div>
            <span className="text-xs text-gray-400 uppercase font-medium">Can Buy Now</span>
          </div>
          <div className="text-4xl font-bold text-emerald-400 font-mono">{stats.canAfford}</div>
        </div>
      </div>
      
      <div className="group relative bg-gradient-to-br from-[#121212] to-[#0d0d0d] rounded-xl p-5 border border-red-500/30 hover:border-red-500/50 transition-all duration-300 overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-br from-red-500/5 to-rose-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
        <div className="relative z-10">
          <div className="flex items-center gap-2 mb-2">
            <div className="p-1.5 rounded-lg bg-red-500/20">
              <Lock className="text-red-400" size={16} />
            </div>
            <span className="text-xs text-gray-400 uppercase font-medium">Rank Locked</span>
          </div>
          <div className="text-4xl font-bold text-red-400 font-mono">{stats.locked}</div>
        </div>
      </div>
      
      <div className="group relative bg-gradient-to-br from-[#121212] to-[#0d0d0d] rounded-xl p-5 border border-green-500/30 hover:border-green-500/50 transition-all duration-300 overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-br from-green-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
        <div className="relative z-10">
          <div className="flex items-center gap-2 mb-2">
            <div className="p-1.5 rounded-lg bg-green-500/20">
              <DollarSign className="text-green-400" size={16} />
            </div>
            <span className="text-xs text-gray-400 uppercase font-medium">Cash Needed</span>
          </div>
          <div className="text-3xl font-bold text-green-400 font-mono">${stats.totalCashNeeded.toFixed(0)}</div>
        </div>
      </div>
      
      <div className="group relative bg-gradient-to-br from-[#121212] to-[#0d0d0d] rounded-xl p-5 border border-[#D4AF37]/30 hover:border-[#D4AF37]/50 transition-all duration-300 overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-br from-[#D4AF37]/5 to-amber-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
        <div className="relative z-10">
          <div className="flex items-center gap-2 mb-2">
            <div className="p-1.5 rounded-lg bg-[#D4AF37]/20">
              <Coins className="text-[#D4AF37]" size={16} />
            </div>
            <span className="text-xs text-gray-400 uppercase font-medium">Gold Needed</span>
          </div>
          <div className="text-3xl font-bold text-[#D4AF37] font-mono">{stats.totalGoldNeeded.toFixed(1)} GB</div>
        </div>
      </div>
    </div>
  );
}

// =========================================================================
// SHOPPING LIST COMPONENT - ENHANCED WITH TABBED NAVIGATION
// =========================================================================

function ShoppingList({ profile, catalog, cart, setCart }) {
  const [filter, setFilter] = useState('all');
  const [priorityFilter, setPriorityFilter] = useState('all');
  const [search, setSearch] = useState('');
  const [showAffordable, setShowAffordable] = useState('all'); // all, affordable, unaffordable
  const [expandedSections, setExpandedSections] = useState({ essential: true, recommended: true });

  // Type counts for navigation badges
  const typeCounts = useMemo(() => {
    const counts = { all: catalog.length };
    catalog.forEach(item => {
      counts[item.type] = (counts[item.type] || 0) + 1;
    });
    return counts;
  }, [catalog]);

  const processedItems = useMemo(() => {
    const items = catalog.map(item => {
      const rankOk = profile.rank >= item.rank;
      const cashOk = profile.cash >= item.price;
      const goldOk = profile.gold >= item.gold;
      const affordable = rankOk && cashOk && goldOk;
      const inCart = cart.includes(item.id);
      
      return { ...item, rankOk, cashOk, goldOk, affordable, inCart };
    });

    // Filter
    let filtered = items.filter(item => {
      if (filter !== 'all' && item.type !== filter) return false;
      if (priorityFilter !== 'all' && item.priority !== priorityFilter) return false;
      if (showAffordable === 'affordable' && !item.affordable) return false;
      if (showAffordable === 'unaffordable' && item.affordable) return false;
      if (search) {
        const s = search.toLowerCase();
        if (!item.name.toLowerCase().includes(s) && !item.desc.toLowerCase().includes(s) && !item.category.toLowerCase().includes(s)) {
          return false;
        }
      }
      return true;
    });

    // Group by priority
    const grouped = {};
    Object.keys(PRIORITY_CONFIG).forEach(p => {
      grouped[p] = filtered.filter(i => i.priority === p).sort((a, b) => {
        // Sort by affordability first (affordable items first), then by price
        if (a.affordable !== b.affordable) return a.affordable ? -1 : 1;
        return (a.price + a.gold * 25) - (b.price + b.gold * 25);
      });
    });

    return grouped;
  }, [catalog, profile, filter, priorityFilter, search, showAffordable, cart]);

  const toggleSection = (priority) => {
    setExpandedSections(prev => ({ ...prev, [priority]: !prev[priority] }));
  };

  const toggleCart = (itemId) => {
    setCart(prev => prev.includes(itemId) ? prev.filter(id => id !== itemId) : [...prev, itemId]);
  };

  const renderItem = (item) => {
    const priorityConfig = PRIORITY_CONFIG[item.priority];
    const typeConfig = TYPE_CONFIG[item.type];
    const TypeIcon = typeConfig?.icon || Package;
    
    return (
      <div 
        key={item.id}
        className={`group relative flex items-center justify-between p-4 rounded-xl border transition-all duration-300 ${
          item.inCart 
            ? 'bg-gradient-to-r from-[#D4AF37]/15 to-[#D4AF37]/5 border-[#D4AF37]/50 shadow-lg shadow-[#D4AF37]/10' 
            : item.affordable 
              ? 'bg-gradient-to-r from-[#1a1a1a] to-[#151515] border-white/10 hover:border-white/25 hover:shadow-md' 
              : 'bg-[#0d0d0d] border-white/5 opacity-50 hover:opacity-70'
        }`}
      >
        {/* Type icon */}
        <div className={`hidden sm:flex p-2.5 rounded-xl ${typeConfig?.bg || 'bg-white/10'} mr-4`}>
          <TypeIcon className={typeConfig?.color || 'text-gray-400'} size={20} />
        </div>
        
        <div className="flex-1 min-w-0">
          <div className="flex flex-wrap items-center gap-2 mb-1.5">
            <span className="font-bold text-[#F5DEB3] truncate">{item.name}</span>
            <span className={`text-xs px-2 py-0.5 rounded-full ${priorityConfig.bg} ${priorityConfig.color} font-medium`}>
              {priorityConfig.label}
            </span>
            {!item.rankOk && (
              <span className="text-xs px-2 py-0.5 rounded-full bg-red-500/20 text-red-400 flex items-center gap-1">
                <Lock size={10} /> Rank {item.rank}
              </span>
            )}
          </div>
          <div className="text-xs text-gray-500 mb-2 line-clamp-1">{item.category} • {item.desc}</div>
          <div className="flex items-center gap-4 text-sm">
            {item.price > 0 && (
              <span className={`font-mono font-medium ${item.cashOk ? 'text-green-400' : 'text-red-400'}`}>
                ${item.price.toFixed(2)}
              </span>
            )}
            {item.gold > 0 && (
              <span className={`font-mono font-medium ${item.goldOk ? 'text-[#D4AF37]' : 'text-red-400'}`}>
                {item.gold} GB
              </span>
            )}
            {item.price === 0 && item.gold === 0 && (
              <span className="text-emerald-400 font-medium">Free</span>
            )}
          </div>
        </div>
        <button
          onClick={() => toggleCart(item.id)}
          disabled={!item.affordable}
          className={`ml-4 p-3 rounded-xl transition-all duration-300 ${
            item.inCart
              ? 'bg-gradient-to-r from-[#D4AF37] to-amber-500 text-black shadow-lg shadow-[#D4AF37]/30 scale-105'
              : item.affordable
                ? 'bg-white/10 text-white hover:bg-white/20 hover:scale-105'
                : 'bg-white/5 text-gray-600 cursor-not-allowed'
          }`}
        >
          <ShoppingCart size={18} />
        </button>
      </div>
    );
  };

  return (
    <div className="bg-gradient-to-br from-[#121212] to-[#0d0d0d] border border-white/10 rounded-2xl overflow-hidden">
      {/* Header */}
      <div className="bg-gradient-to-r from-[#1a1512] to-[#12100d] border-b border-white/10 p-6">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-white font-western text-2xl flex items-center gap-3">
            <div className="p-2 rounded-xl bg-[#D4AF37]/20">
              <Package className="text-[#D4AF37]" size={24} />
            </div>
            Shopping List
          </h2>
          <div className="flex items-center gap-2 text-sm">
            <span className="text-gray-500">Showing</span>
            <span className="text-[#D4AF37] font-bold font-mono">{Object.values(processedItems).flat().length}</span>
            <span className="text-gray-500">items</span>
          </div>
        </div>

        {/* Category Navigation Tabs - PROMINENT */}
        <div className="flex flex-wrap gap-2 mb-4">
          <button
            onClick={() => setFilter('all')}
            className={`flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium transition-all duration-300 ${
              filter === 'all'
                ? 'bg-gradient-to-r from-[#D4AF37] to-amber-500 text-black shadow-lg shadow-[#D4AF37]/30'
                : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white'
            }`}
          >
            <Sparkles size={16} />
            All
            <span className="text-xs opacity-75">({typeCounts.all})</span>
          </button>
          {Object.entries(TYPE_CONFIG).map(([type, config]) => {
            const Icon = config.icon;
            const count = typeCounts[type] || 0;
            if (count === 0) return null;
            return (
              <button
                key={type}
                onClick={() => setFilter(type)}
                className={`flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-medium transition-all duration-300 ${
                  filter === type
                    ? `${config.bg} ${config.color} shadow-lg`
                    : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white'
                }`}
              >
                <Icon size={14} />
                <span className="hidden sm:inline">{config.label}</span>
                <span className="text-xs opacity-75">({count})</span>
              </button>
            );
          })}
        </div>

        {/* Search and Filters Row */}
        <div className="flex flex-wrap gap-3">
          <div className="flex-1 min-w-[200px]">
            <div className="relative group">
              <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 group-focus-within:text-[#D4AF37] transition-colors" size={18} />
              <input
                type="text"
                placeholder="Search items by name or description..."
                value={search}
                onChange={e => setSearch(e.target.value)}
                className="w-full bg-black/60 border-2 border-white/10 hover:border-white/20 rounded-xl pl-11 pr-4 py-3 text-white text-sm focus:outline-none focus:border-[#D4AF37]/50 focus:ring-2 focus:ring-[#D4AF37]/20 transition-all placeholder:text-gray-500"
              />
            </div>
          </div>

          {/* Priority Filter - Dark Dropdown */}
          <div className="relative group">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-violet-400/70 pointer-events-none z-10">
              <TrendingUp size={16} />
            </div>
            <select
              value={priorityFilter}
              onChange={e => setPriorityFilter(e.target.value)}
              className="appearance-none bg-[#1a1a1a] border border-white/10 hover:border-white/20 rounded-lg pl-10 pr-10 py-2.5 text-gray-200 text-sm focus:outline-none focus:border-violet-500/50 cursor-pointer transition-all"
              style={{ colorScheme: 'dark' }}
            >
              <option value="all" className="bg-[#1a1a1a] text-gray-200">⚡ All Priorities</option>
              {Object.entries(PRIORITY_CONFIG).map(([key, cfg]) => (
                <option key={key} value={key} className="bg-[#1a1a1a] text-gray-200">{cfg.emoji || '•'} {cfg.label}</option>
              ))}
            </select>
            <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none" size={16} />
          </div>

          {/* Affordability Filter - Dark Dropdown */}
          <div className="relative group">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-emerald-400/70 pointer-events-none z-10">
              <DollarSign size={16} />
            </div>
            <select
              value={showAffordable}
              onChange={e => setShowAffordable(e.target.value)}
              className="appearance-none bg-[#1a1a1a] border border-white/10 hover:border-white/20 rounded-lg pl-10 pr-10 py-2.5 text-gray-200 text-sm focus:outline-none focus:border-emerald-500/50 cursor-pointer transition-all"
              style={{ colorScheme: 'dark' }}
            >
              <option value="all" className="bg-[#1a1a1a] text-gray-200">💰 All Items</option>
              <option value="affordable" className="bg-[#1a1a1a] text-gray-200">✓ Can Afford</option>
              <option value="unaffordable" className="bg-[#1a1a1a] text-gray-200">✗ Can't Afford</option>
            </select>
            <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 pointer-events-none" size={16} />
          </div>
        </div>
      </div>

      {/* Items by Priority */}
      <div className="p-6 space-y-4 max-h-[600px] overflow-y-auto custom-scrollbar">
        {Object.entries(PRIORITY_CONFIG)
          .sort((a, b) => a[1].order - b[1].order)
          .map(([priority, config]) => {
            const items = processedItems[priority] || [];
            if (items.length === 0) return null;
            
            const isExpanded = expandedSections[priority] !== false;
            const PriorityIcon = config.icon || Package;
            
            return (
              <div key={priority} className={`border ${config.border} rounded-xl overflow-hidden transition-all duration-300 hover:shadow-lg ${config.glow}`}>
                <button
                  onClick={() => toggleSection(priority)}
                  className={`w-full flex items-center justify-between p-4 ${config.bg} hover:brightness-110 transition-all duration-300`}
                >
                  <div className="flex items-center gap-3">
                    <div className={`p-2 rounded-lg bg-black/20`}>
                      <PriorityIcon className={config.color} size={18} />
                    </div>
                    <div className="text-left">
                      <span className={`font-bold ${config.color}`}>{config.label}</span>
                      <p className="text-xs text-gray-400 hidden sm:block">{config.desc}</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-3">
                    <span className={`text-sm font-mono font-bold ${config.color}`}>{items.length}</span>
                    <div className={`p-1 rounded-lg bg-black/20 transition-transform duration-300 ${isExpanded ? 'rotate-180' : ''}`}>
                      <ChevronDown size={18} className="text-gray-400" />
                    </div>
                  </div>
                </button>
                
                {isExpanded && (
                  <div className="p-4 space-y-3 bg-gradient-to-b from-[#0a0a0a] to-[#080808]">
                    {items.map(renderItem)}
                  </div>
                )}
              </div>
            );
          })}
      </div>
    </div>
  );
}

// =========================================================================
// CART SUMMARY COMPONENT
// =========================================================================

function CartSummary({ profile, catalog, cart, setCart }) {
  const cartItems = useMemo(() => {
    return cart.map(id => catalog.find(i => i.id === id)).filter(Boolean);
  }, [cart, catalog]);

  const totals = useMemo(() => {
    return cartItems.reduce((acc, item) => ({
      cash: acc.cash + item.price,
      gold: acc.gold + item.gold,
    }), { cash: 0, gold: 0 });
  }, [cartItems]);

  const remaining = {
    cash: profile.cash - totals.cash,
    gold: profile.gold - totals.gold,
  };

  const canAffordAll = remaining.cash >= 0 && remaining.gold >= 0;

  if (cart.length === 0) {
    return (
      <div className="bg-[#121212] border border-white/10 rounded-xl p-6 text-center">
        <ShoppingCart className="mx-auto text-gray-600 mb-3" size={48} />
        <h3 className="text-gray-400 font-bold mb-2">Your Cart is Empty</h3>
        <p className="text-gray-600 text-sm">Click the cart icon on items to add them to your purchase plan</p>
      </div>
    );
  }

  return (
    <div className="bg-[#121212] border border-white/10 rounded-xl p-6">
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-white font-western text-xl flex items-center gap-2">
          <ShoppingCart className="text-[#D4AF37]" size={20} />
          Purchase Plan
        </h3>
        <button
          onClick={() => setCart([])}
          className="text-xs text-red-400 hover:text-red-300"
        >
          Clear All
        </button>
      </div>

      <div className="space-y-2 max-h-[200px] overflow-y-auto mb-4">
        {cartItems.map(item => (
          <div key={item.id} className="flex items-center justify-between text-sm p-2 bg-[#0a0a0a] rounded">
            <span className="text-gray-300">{item.name}</span>
            <div className="flex items-center gap-3">
              {item.price > 0 && <span className="text-green-400">${item.price}</span>}
              {item.gold > 0 && <span className="text-[#D4AF37]">{item.gold} GB</span>}
              <button onClick={() => setCart(c => c.filter(id => id !== item.id))} className="text-red-400 hover:text-red-300">×</button>
            </div>
          </div>
        ))}
      </div>

      <div className="border-t border-white/10 pt-4 space-y-2">
        <div className="flex justify-between text-sm">
          <span className="text-gray-400">Total Cost:</span>
          <div className="flex gap-3">
            <span className="text-green-400 font-mono">${totals.cash.toFixed(2)}</span>
            <span className="text-[#D4AF37] font-mono">{totals.gold.toFixed(1)} GB</span>
          </div>
        </div>
        <div className="flex justify-between text-sm">
          <span className="text-gray-400">After Purchase:</span>
          <div className="flex gap-3">
            <span className={`font-mono ${remaining.cash >= 0 ? 'text-green-400' : 'text-red-400'}`}>
              ${remaining.cash.toFixed(2)}
            </span>
            <span className={`font-mono ${remaining.gold >= 0 ? 'text-[#D4AF37]' : 'text-red-400'}`}>
              {remaining.gold.toFixed(1)} GB
            </span>
          </div>
        </div>
      </div>

      <div className={`mt-4 p-3 rounded-lg text-center ${canAffordAll ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>
        {canAffordAll ? (
          <span className="flex items-center justify-center gap-2">
            <Unlock size={16} /> You can afford this purchase!
          </span>
        ) : (
          <span className="flex items-center justify-center gap-2">
            <Lock size={16} /> Not enough resources
          </span>
        )}
      </div>
    </div>
  );
}

// =========================================================================
// NEXT GOALS COMPONENT
// =========================================================================

function NextGoals({ profile, catalog }) {
  const recommendations = useMemo(() => {
    const unlocked = catalog.filter(i => profile.rank >= i.rank && i.priority === 'essential');
    const affordable = unlocked.filter(i => profile.cash >= i.price && profile.gold >= i.gold);
    const nextUnlocks = catalog
      .filter(i => profile.rank < i.rank && i.priority === 'essential')
      .sort((a, b) => a.rank - b.rank)
      .slice(0, 3);
    
    const savingFor = catalog
      .filter(i => profile.rank >= i.rank && (profile.cash < i.price || profile.gold < i.gold) && i.priority === 'essential')
      .sort((a, b) => (a.price + a.gold * 25) - (b.price + b.gold * 25))
      .slice(0, 3);

    return { affordable: affordable.slice(0, 5), nextUnlocks, savingFor };
  }, [profile, catalog]);

  return (
    <div className="bg-[#121212] border border-white/10 rounded-xl p-6">
      <h3 className="text-white font-western text-xl flex items-center gap-2 mb-4">
        <Target className="text-[#D4AF37]" size={20} />
        Recommended Next Steps
      </h3>

      {recommendations.affordable.length > 0 && (
        <div className="mb-4">
          <h4 className="text-green-400 text-sm font-bold mb-2 flex items-center gap-2">
            <Unlock size={14} /> Buy Now (Essential)
          </h4>
          <div className="space-y-1">
            {recommendations.affordable.map(item => (
              <div key={item.id} className="text-sm text-gray-300 flex justify-between">
                <span>{item.name}</span>
                <span className="text-green-400">
                  {item.price > 0 ? `$${item.price}` : ''} 
                  {item.gold > 0 ? ` ${item.gold} GB` : ''}
                </span>
              </div>
            ))}
          </div>
        </div>
      )}

      {recommendations.savingFor.length > 0 && (
        <div className="mb-4">
          <h4 className="text-yellow-400 text-sm font-bold mb-2 flex items-center gap-2">
            <TrendingUp size={14} /> Save For
          </h4>
          <div className="space-y-1">
            {recommendations.savingFor.map(item => (
              <div key={item.id} className="text-sm text-gray-300 flex justify-between">
                <span>{item.name}</span>
                <span className="text-yellow-400">
                  {item.price > profile.cash ? `Need $${(item.price - profile.cash).toFixed(0)} more` : ''}
                  {item.gold > profile.gold ? ` Need ${(item.gold - profile.gold).toFixed(1)} GB more` : ''}
                </span>
              </div>
            ))}
          </div>
        </div>
      )}

      {recommendations.nextUnlocks.length > 0 && (
        <div>
          <h4 className="text-blue-400 text-sm font-bold mb-2 flex items-center gap-2">
            <Star size={14} /> Unlocks Soon
          </h4>
          <div className="space-y-1">
            {recommendations.nextUnlocks.map(item => (
              <div key={item.id} className="text-sm text-gray-300 flex justify-between">
                <span>{item.name}</span>
                <span className="text-blue-400">Rank {item.rank}</span>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}

// =========================================================================
// MAIN APP COMPONENT
// =========================================================================

function App() {
  // Default profile based on the case study: Level 47, $1,444, 9.5 gold, 25 tokens
// XP for level 47 is approximately 136,800 (cumulative)
  const [profile, setProfile] = useState({
    rank: 47,
    xp: 136800,
    cash: 1444,
    gold: 9.5,
    tokens: 25,
    roles: {
      bountyHunter: 0,
      trader: 0,
      collector: 0,
      moonshiner: 0,
      naturalist: 0,
    },
  });

  const [cart, setCart] = useState([]);

  return (
    <div className="min-h-screen bg-gradient-to-b from-[#0a0a0a] via-[#080808] to-[#050505] text-gray-200 font-body">
      {/* Header - RDR2 WESTERN STYLE */}
      <header className="relative bg-gradient-to-b from-[#1a1512] via-[#12100d] to-transparent border-b border-[#D4AF37]/20 py-8 px-8 overflow-hidden">
        {/* Decorative elements */}
        <div className="absolute top-0 left-0 w-96 h-96 bg-gradient-to-br from-[#D4AF37]/5 to-transparent rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2" />
        <div className="absolute top-0 right-0 w-64 h-64 bg-gradient-to-bl from-amber-900/10 to-transparent rounded-full blur-2xl translate-x-1/4" />
        
        <div className="relative z-10 max-w-7xl mx-auto flex items-center justify-between">
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-[#D4AF37] to-amber-600 flex items-center justify-center shadow-lg shadow-[#D4AF37]/20">
                <Crosshair className="text-black" size={28} />
              </div>
              <div className="absolute -bottom-1 -right-1 w-5 h-5 rounded-full bg-emerald-500 border-2 border-[#0a0a0a] animate-pulse" />
            </div>
            <div>
              <h1 className="text-transparent bg-clip-text bg-gradient-to-r from-[#D4AF37] to-amber-500 font-western text-4xl tracking-wide">
                RDO Character OS
              </h1>
              <p className="text-gray-400 text-sm mt-1 flex items-center gap-2">
                <Sparkles size={14} className="text-[#D4AF37]" />
                Pocket Simulator • Plan your purchases before you play
              </p>
            </div>
          </div>
          <div className="text-right">
            <div className="text-xs text-gray-500 uppercase tracking-wider mb-1">Catalog Items</div>
            <div className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-[#F5DEB3] to-amber-400 font-mono tracking-tight">{CATALOG.length}</div>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto p-8">
        {/* Player Profile - THE PRIMARY FEATURE */}
        <PlayerProfile profile={profile} setProfile={setProfile} />

        {/* Stats Summary */}
        <StatsSummary profile={profile} catalog={CATALOG} />

        {/* Main Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Shopping List - Main Column */}
          <div className="lg:col-span-2">
            <ShoppingList 
              profile={profile} 
              catalog={CATALOG} 
              cart={cart} 
              setCart={setCart} 
            />
          </div>

          {/* Sidebar */}
          <div className="space-y-6">
            <CartSummary 
              profile={profile} 
              catalog={CATALOG} 
              cart={cart} 
              setCart={setCart} 
            />
            <FastTravelCalculator />
            <NextGoals profile={profile} catalog={CATALOG} />
          </div>
        </div>
      </main>

      {/* Footer */}
      <footer className="border-t border-white/5 py-8 px-8 mt-12 bg-gradient-to-t from-[#050505] to-transparent">
        <div className="max-w-7xl mx-auto text-center">
          <p className="text-gray-500 text-sm flex items-center justify-center gap-2">
            <Crosshair size={14} className="text-[#D4AF37]" />
            RDO Character OS • Built for Red Dead Online players
          </p>
          <p className="text-gray-600 text-xs mt-2">
            Adjust your stats above to simulate purchases. All prices accurate to in-game catalog.
          </p>
        </div>
      </footer>
    </div>
  );
}

export default App;
 